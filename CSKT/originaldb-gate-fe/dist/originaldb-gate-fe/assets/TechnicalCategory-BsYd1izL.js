import{e as A,J as j,O as K,Q as F,R as O,t as E,v as L,w as V,x as M,r as g,j as n,k as R,q as P,F as U,y as o,U as q,z,B as I,W as G,E as B,G as H}from"./index-DXrCg2vr.js";import{M as X}from"./ModalCategoryActionHeader-CMTsFAdF.js";import{I as _}from"./ItemsComponent-Ct2UsBCT.js";import{a as J}from"./arrayToTree.min-Bpdh5Rxo.js";import"./index-B0_H1u92.js";import"./index-CfEarsVi.js";import"./index-Bb5KQ1O1.js";const u={CODE:"Ký hiệu",ORG_ID:"Đơn vị",DESCRIPTION:"Ghi chú",IS_ENABLE:"Trạng thái"},b="technical_category",Q=(a,s)=>A(b,{...a,fields:["*",{org_id:["*"]}],filter:s}),W=async a=>{var d;return{count:(d=(await j(b,{aggregate:{countDistinct:"id"},query:{filter:a}}))[0].countDistinct)==null?void 0:d.id}},Y=a=>K(b,{...a}),Z=(a,s)=>F(b,a,{...s}),$=a=>O(b,a),v=({action:a,detail:s})=>{const[d]=E.useForm(),i=L(),N=V(),{openMessage:m}=M(),[f,h]=g.useState([]),k=async()=>{const e=await q({});h(J.arrayToTree([...e],{dataField:null}))},r=g.useMemo(()=>[{title:u.ORG_ID,content:(s==null?void 0:s.org_id)||null,require:!0,dataIndex:"org_id",rules:[{required:!0,message:"Thông tin không được để trống!"}]},{title:u.DESCRIPTION,content:(s==null?void 0:s.note)||null,dataIndex:"note"},{title:"Số thứ tự",content:(s==null?void 0:s.order_number)||null,dataIndex:"order_number"},{title:"Trạng thái",content:(s==null?void 0:s.is_enable)===void 0?!0:s==null?void 0:s.is_enable,dataIndex:"is_enable"}],[s]),C=()=>{if(a===o.View){x();return}else d.submit()},x=()=>{i.hide(),N.closeModal({success:!0})},p=async()=>{var e,l;try{i.show();const t=d.getFieldsValue(),c=(e=t==null?void 0:t.org_id)!=null&&e.value?(l=t==null?void 0:t.org_id)==null?void 0:l.value:t==null?void 0:t.org_id;switch(a){case o.Update:await Z(s==null?void 0:s.id,{...t,org_id:c}),m({type:"success",content:"Cập nhật thành công"});break;case o.Create:await Y(t),m({type:"success",content:"Thêm mới thành công"}),d.resetFields();break;case o.View:break}x()}catch(t){console.log(t),m({type:"error",content:(t==null?void 0:t.message)||"Lỗi hệ thống"}),i.hide()}},T=async()=>{try{await $(s==null?void 0:s.id),m({type:"success",content:"Xóa thành công"}),i.hide(),N.closeModal({})}catch(e){console.log(e),m({type:"error",content:(e==null?void 0:e.message)||"Lỗi hệ thống"})}};return g.useEffect(()=>{k()},[]),n.jsxDEV(R,{...P,className:"flex",size:20,children:[n.jsxDEV(U,{align:"center",justify:"space-between",className:"absolute bg-white left-0 right-0 px-6 pb-3 z-50",children:n.jsxDEV(X,{name:"Đơn vị XLSC",action:a,hanldeFinish:C,handleDelete:T},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/TechnicalCategoryAction.tsx",lineNumber:152,columnNumber:9},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/TechnicalCategoryAction.tsx",lineNumber:147,columnNumber:7},void 0),n.jsxDEV(E,{form:d,className:"form-container bg-secondary p-5 rounded-primary mt-10 grid grid-cols-2 gap-2",onFinish:p,disabled:a===o.View,children:a===o.Update||a===o.Create?n.jsxDEV(n.Fragment,{children:r.map((e,l)=>n.jsxDEV(_,{title:e==null?void 0:e.title,rules:e==null?void 0:e.rules,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!0,dataIndex:e.dataIndex,isNumberField:(e==null?void 0:e.dataIndex)==="order_number",treeField:{isSelect:(e==null?void 0:e.dataIndex)==="org_id",dataSelect:f},isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"},l,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/TechnicalCategoryAction.tsx",lineNumber:164,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/TechnicalCategoryAction.tsx",lineNumber:161,columnNumber:11},void 0):n.jsxDEV(n.Fragment,{children:r.map((e,l)=>n.jsxDEV("div",{className:"flex flex-col pb-4",children:n.jsxDEV(_,{title:e==null?void 0:e.title,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!1,dataIndex:e.dataIndex,isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"},l,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/TechnicalCategoryAction.tsx",lineNumber:199,columnNumber:19},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/TechnicalCategoryAction.tsx",lineNumber:198,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/TechnicalCategoryAction.tsx",lineNumber:195,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/TechnicalCategoryAction.tsx",lineNumber:154,columnNumber:7},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/TechnicalCategoryAction.tsx",lineNumber:142,columnNumber:5},void 0)},S=v,ee=[{key:o.View,icon:n.jsxDEV(H,{},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/TechnicalCategory.tsx",lineNumber:21,columnNumber:11},void 0),tooltip:"Chi tiết"}];function re(){const{openModal:a}=V(),[s,d]=g.useState([]),[i,N]=g.useState({count:0}),[m,f]=g.useState(!1),[h,k]=g.useState({}),[r,C]=g.useState({page:1,pageSize:z}),x=[{title:u.ORG_ID,dataIndex:"org_id",key:I.Name,render:(t,c)=>n.jsxDEV("span",{className:"font-semibold text-sm cursor-pointer text-[#3D73D0]",onClick:()=>T(o.View,c),children:(t==null?void 0:t.name)??""},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/TechnicalCategory.tsx",lineNumber:41,columnNumber:11},this)},{title:u.CODE,dataIndex:"code"},{title:u.IS_ENABLE,dataIndex:"is_enable",render:t=>t?n.jsxDEV("span",{className:"text-green-600",children:"Hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/TechnicalCategory.tsx",lineNumber:58,columnNumber:41},this):n.jsxDEV("span",{className:"text-red",children:"Không hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/TechnicalCategory.tsx",lineNumber:58,columnNumber:93},this)},{title:u.DESCRIPTION,dataIndex:"note"}].map(t=>({...t,key:(t==null?void 0:t.key)||G()})),p=async(t,c,w)=>{try{let y={};Object.keys(w).length>0&&(y={org_id:{...w}}),f(!0);const D=await Promise.all([await Q({limit:c,page:t},y),await W(y)]);d(D[0]),N(D[1]),f(!1)}catch{f(!1)}},T=(t,c)=>{t===o.View&&e(c)},e=t=>{a(n.jsxDEV(S,{detail:t,action:o.View},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/TechnicalCategory.tsx",lineNumber:109,columnNumber:7},this),{width:"40vw",onModalClose(c){c!=null&&c.success?a(n.jsxDEV(S,{detail:t,action:o.Update},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/TechnicalCategory.tsx",lineNumber:115,columnNumber:15},this),{width:"40vw",onModalClose(){l()}}):l()}})},l=()=>{p(r.page,r.pageSize,h)};return g.useEffect(()=>{p(r.page,r.pageSize,h)},[r,h]),n.jsxDEV(n.Fragment,{children:n.jsxDEV(B,{total:(i==null?void 0:i.count)||0,className:"mt-5",setFilter:k,setPagination:C,isReloadButton:!1,dataSource:s,columns:x,actionList:ee,isAction:!1,loading:m,paginationCustom:{current:r.page,pageSize:r.pageSize,total:i==null?void 0:i.count},onChange:({current:t,pageSize:c})=>{C({page:t,pageSize:c}),p(t,c,h)},actionClick:T,filterColumns:[I.Name],btnCreate:!0,handleCreate:()=>{a(n.jsxDEV(S,{action:o.Create},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/TechnicalCategory.tsx",lineNumber:168,columnNumber:13},this),{width:"40vw",onModalClose(t){t!=null&&t.success&&l()}})}},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/TechnicalCategory.tsx",lineNumber:141,columnNumber:7},this)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/TechnicalCategory.tsx",lineNumber:140,columnNumber:5},this)}export{ee as ACTION_TABLE,re as default};
