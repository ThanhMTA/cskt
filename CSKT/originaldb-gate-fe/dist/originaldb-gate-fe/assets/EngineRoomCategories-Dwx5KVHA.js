import{e as O,J as W,K as J,O as Q,Q as X,R as Z,t as F,v as Y,w as z,x as $,r as g,j as s,k as v,q as ee,F as te,S as ne,y as d,U as re,z as se,B as E,V as ie,W as oe,E as ae,G as ce}from"./index-DXrCg2vr.js";import{M as de}from"./ModalCategoryActionHeader-CMTsFAdF.js";import{g as ge}from"./Ward.action-D2xWCgQ3.js";import{I as G}from"./ItemsComponent-Ct2UsBCT.js";import{a as me}from"./arrayToTree.min-Bpdh5Rxo.js";import"./index-B0_H1u92.js";import"./index-CfEarsVi.js";import"./index-Bb5KQ1O1.js";const le=(a,o)=>O("engine_room_categories",{...a,fields:["*",{org_id:["*"]},{org_support_id:["*"]},{org_technical_id:["*"]},{org_use_id:["*"]},{ward_id:["*",{district_id:["*",{province_id:["*"]}]}]}],filter:o,sort:["-date_created"]}),he=async a=>{var m;return{count:(m=(await W("engine_room_categories",{aggregate:{countDistinct:"id"},query:{filter:a}}))[0].countDistinct)==null?void 0:m.id}},_e=(a,o)=>J("engine_room_categories",a,{fields:["*",{org_id:["*"]},{org_support_id:["*"]},{org_technical_id:["*"]},{org_use_id:["*"]},{ward_id:["*",{district_id:["*",{province_id:["*"]}]}]}],filter:o}),pe=a=>(console.log("params: ",a),Q("engine_room_categories",{...a})),ue=(a,o)=>(console.log("params: ",o),X("engine_room_categories",a,{...o})),fe=a=>Z("engine_room_categories",a);function S({id:a,action:o}){const[m]=F.useForm(),p=Y(),k=z(),{openMessage:l}=$(),[t,I]=g.useState(),[x,_]=g.useState(!1),[y,w]=g.useState({organizations:[],wards:[]}),u=async()=>{var e,i,T,D,R,j,q,V,K,P,A,M;try{p.show();let h=null;const r=m.getFieldsValue();switch(o){case d.Update:const B=(e=r==null?void 0:r.org_id)!=null&&e.value?(i=r==null?void 0:r.org_id)==null?void 0:i.value:r==null?void 0:r.org_id,L=(T=r==null?void 0:r.org_use_id)!=null&&T.value?(D=r==null?void 0:r.org_use_id)==null?void 0:D.value:r==null?void 0:r.org_use_id,U=(R=r==null?void 0:r.org_technical_id)!=null&&R.value?(j=r==null?void 0:r.org_technical_id)==null?void 0:j.value:r==null?void 0:r.org_technical_id,H=(q=r==null?void 0:r.org_support_id)!=null&&q.value?(V=r==null?void 0:r.org_support_id)==null?void 0:V.value:r==null?void 0:r.org_support_id;h=(K=r==null?void 0:r.ward_id)!=null&&K.ward?(P=r==null?void 0:r.ward_id)==null?void 0:P.ward:null,await ue(t==null?void 0:t.id,{...r,org_id:B,org_use_id:L,org_technical_id:U,org_support_id:H,ward_id:h}),l({type:"success",content:"Cập nhật thành công"});break;case d.Create:h=(A=r==null?void 0:r.ward_id)!=null&&A.ward?(M=r==null?void 0:r.ward_id)==null?void 0:M.ward:null,await pe({...r,ward_id:h}),l({type:"success",content:"Thêm mới thành công"}),m.resetFields();break;case d.View:break}f()}catch(h){console.log(h),l({type:"error",content:(h==null?void 0:h.message)||"Lỗi hệ thống"}),p.hide()}},C=async()=>{try{await fe(t==null?void 0:t.id),l({type:"success",content:"Xóa thành công"}),p.hide(),k.closeModal({})}catch(e){console.log(e),l({type:"error",content:(e==null?void 0:e.message)||"Lỗi hệ thống"})}},N=()=>{if(o===d.View){f();return}else{u();return}},f=()=>{p.hide(),k.closeModal({success:!0})},n=async()=>{try{_(!0);const e=await _e(a,{});I(e),_(!1)}catch(e){console.log(e),_(!1)}},c=async()=>{const e=await Promise.all([await re({}),await ge({},{})]);w({organizations:me.arrayToTree([...e[0]],{dataField:null}),wards:e[1]})},b=g.useMemo(()=>[{title:"Tên phòng máy CNTT",content:(t==null?void 0:t.name)||null,require:!0,dataIndex:"name",rules:[{required:!0,message:"Hãy nhập thông tin cho trường tên phòng máy CNTT"}]},{title:"Tên viết tắt",content:(t==null?void 0:t.short_name)||null,require:!1,dataIndex:"short_name"},{title:"Số điện thoại",content:(t==null?void 0:t.phone_number)||null,require:!1,dataIndex:"phone_number"},{title:"Cách liên lạc",content:(t==null?void 0:t.contact_method)||null,require:!1,dataIndex:"contact_method"},{title:"Đơn vị cấp trên quản lý",content:(t==null?void 0:t.org_id)||null,require:!1,dataIndex:"org_id"},{title:"Đơn vị khai thác",content:(t==null?void 0:t.org_use_id)||null,require:!1,dataIndex:"org_use_id"},{title:"Đơn vị đảm bảo kỹ thuật",content:(t==null?void 0:t.org_technical_id)||null,require:!1,dataIndex:"org_technical_id"},{title:"Đơn vị hỗ trợ bảo đảm kỹ thuật",content:(t==null?void 0:t.org_support_id)||null,require:!1,dataIndex:"org_support_id"},{title:"Địa bàn",content:(t==null?void 0:t.ward_id)||null,require:!1,dataIndex:"ward_id"},{title:"Vị trí phòng máy",content:(t==null?void 0:t.address)||null,require:!1,dataIndex:"address"},{title:"Kinh độ (Độ N)",content:(t==null?void 0:t.longitude)||null,require:!1,dataIndex:"longitude"},{title:"Vĩ độ (Độ E)",content:(t==null?void 0:t.latitude)||null,require:!1,dataIndex:"latitude"},{title:"Diện tích PMC (m2)",content:(t==null?void 0:t.area)||null,require:!1,dataIndex:"area",rules:[{validator:(e,i)=>Number(i)<0?Promise.reject("Giá trị không hợp lệ."):Promise.resolve()}]},{title:"Số lượng máy chủ vật lý",content:(t==null?void 0:t.n_phy_server)||null,require:!1,dataIndex:"n_phy_server",rules:[{validator:(e,i)=>Number(i)<0?Promise.reject("Giá trị không hợp lệ."):Promise.resolve()}]},{title:"Số lượng máy chủ ảo",content:(t==null?void 0:t.n_vir_server)||null,require:!1,dataIndex:"n_vir_server",rules:[{validator:(e,i)=>Number(i)<0?Promise.reject("Giá trị không hợp lệ."):Promise.resolve()}]},{title:"Tổng số lượng ứng dụng, dịch vụ",content:(t==null?void 0:t.sum_app_service)||null,require:!1,dataIndex:"sum_app_service",rules:[{validator:(e,i)=>Number(i)<0?Promise.reject("Giá trị không hợp lệ."):Promise.resolve()}]},{title:"Năng lực xử lý CPU (GHz)",content:(t==null?void 0:t.ability_cpu)||null,require:!1,dataIndex:"ability_cpu",rules:[{validator:(e,i)=>Number(i)<0?Promise.reject("Giá trị không hợp lệ."):Promise.resolve()}]},{title:"Tổng dung lượng RAM (GB)",content:(t==null?void 0:t.sum_ram)||null,require:!1,dataIndex:"sum_ram",rules:[{validator:(e,i)=>Number(i)<0?Promise.reject("Giá trị không hợp lệ."):Promise.resolve()}]},{title:"Băng thông (Mbps)",content:(t==null?void 0:t.bandwidth)||null,require:!1,dataIndex:"bandwidth",rules:[{validator:(e,i)=>Number(i)<0?Promise.reject("Giá trị không hợp lệ."):Promise.resolve()}]},{title:"Tài nguyên lưu trữ (TB)",content:(t==null?void 0:t.n_storage)||null,require:!1,dataIndex:"n_storage",rules:[{validator:(e,i)=>Number(i)<0?Promise.reject("Giá trị không hợp lệ."):Promise.resolve()}]},{title:"Số lượng tủ RACK",content:(t==null?void 0:t.n_rack)||null,require:!1,dataIndex:"n_rack",rules:[{validator:(e,i)=>Number(i)<0?Promise.reject("Giá trị không hợp lệ."):Promise.resolve()}]},{title:"Mật độ tài nguyên lưu trữ (%)",content:(t==null?void 0:t.n_percent_density)||null,require:!1,dataIndex:"n_percent_density",rules:[{validator:(e,i)=>Number(i)<0?Promise.reject("Giá trị không hợp lệ."):Promise.resolve()}]},{title:"Đánh giá khả năng khai thác, vận hành (Điểm mạnh, yếu)",content:(t==null?void 0:t.comment)||null,require:!1,dataIndex:"comment"},{title:"Hồ sơ kỹ thuật",content:(t==null?void 0:t.url_file_path)||null,require:!1,dataIndex:"url_file_path"},{title:"Số thứ tự",content:(t==null?void 0:t.order_number)||null,require:!1,dataIndex:"order_number"},{title:"Có đảm bảo nguồn điện",content:(t==null?void 0:t.has_power_source)||null,require:!1,dataIndex:"has_power_source"},{title:"Có chống sét",content:(t==null?void 0:t.has_lighting_protect)||null,require:!1,dataIndex:"has_lighting_protect"},{title:"Có phòng cháy, chữa cháy",content:(t==null?void 0:t.has_fighting_protect)||null,require:!1,dataIndex:"has_fighting_protect"},{title:"Trạng thái",content:(t==null?void 0:t.is_enable)===void 0?!0:t==null?void 0:t.is_enable,require:!1,dataIndex:"is_enable"}],[t]);return g.useEffect(()=>{c(),a&&n()},[a]),s.jsxDEV(v,{...ee,className:"flex",size:20,children:[s.jsxDEV(te,{align:"center",justify:"space-between",className:"absolute bg-white left-0 right-0 px-6 pb-3 z-50",children:s.jsxDEV(de,{name:"phòng máy CNTT",action:o,hanldeFinish:N,handleDelete:C},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/components/EngineRoomAction.tsx",lineNumber:445,columnNumber:17},this)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/components/EngineRoomAction.tsx",lineNumber:440,columnNumber:13},this),x?s.jsxDEV(s.Fragment,{children:s.jsxDEV(ne,{},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/components/EngineRoomAction.tsx",lineNumber:447,columnNumber:28},this)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/components/EngineRoomAction.tsx",lineNumber:447,columnNumber:26},this):s.jsxDEV(F,{form:m,className:"form-container bg-secondary p-5 rounded-primary mt-10 grid grid-cols-4 gap-4",onFinish:u,requiredMark:!1,children:o===d.Update||o===d.Create?s.jsxDEV(s.Fragment,{children:b.map((e,i)=>s.jsxDEV(G,{title:e==null?void 0:e.title,rules:e==null?void 0:e.rules,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!0,dataIndex:e.dataIndex,treeField:{isSelect:(e==null?void 0:e.dataIndex)==="org_id"||(e==null?void 0:e.dataIndex)==="org_use_id"||(e==null?void 0:e.dataIndex)==="org_support_id"||(e==null?void 0:e.dataIndex)==="org_technical_id",dataSelect:y.organizations},addressField:(e==null?void 0:e.dataIndex)==="ward_id",isNumberField:(e==null?void 0:e.dataIndex)==="area"||(e==null?void 0:e.dataIndex)==="n_phy_server"||(e==null?void 0:e.dataIndex)==="sum_app_service"||(e==null?void 0:e.dataIndex)==="ability_cpu"||(e==null?void 0:e.dataIndex)==="sum_ram"||(e==null?void 0:e.dataIndex)==="bandwidth"||(e==null?void 0:e.dataIndex)==="n_storage"||(e==null?void 0:e.dataIndex)==="n_rack"||(e==null?void 0:e.dataIndex)==="n_percent_density"||(e==null?void 0:e.dataIndex)==="order_number"||(e==null?void 0:e.dataIndex)==="n_vir_server",isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"||(e==null?void 0:e.dataIndex)==="has_fighting_protect"||(e==null?void 0:e.dataIndex)==="has_lighting_protect"||(e==null?void 0:e.dataIndex)==="has_power_source"},i,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/components/EngineRoomAction.tsx",lineNumber:457,columnNumber:33},this))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/components/EngineRoomAction.tsx",lineNumber:454,columnNumber:21},this):s.jsxDEV(s.Fragment,{children:b.map((e,i)=>s.jsxDEV("div",{className:"flex flex-col pb-4",children:s.jsxDEV(G,{title:e==null?void 0:e.title,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!1,dataIndex:e.dataIndex,isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"||(e==null?void 0:e.dataIndex)==="has_fighting_protect"||(e==null?void 0:e.dataIndex)==="has_lighting_protect"||(e==null?void 0:e.dataIndex)==="has_power_source"},i,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/components/EngineRoomAction.tsx",lineNumber:502,columnNumber:37},this)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/components/EngineRoomAction.tsx",lineNumber:501,columnNumber:33},this))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/components/EngineRoomAction.tsx",lineNumber:498,columnNumber:21},this)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/components/EngineRoomAction.tsx",lineNumber:447,columnNumber:46},this)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/components/EngineRoomAction.tsx",lineNumber:435,columnNumber:9},this)}const xe=[{key:d.View,icon:s.jsxDEV(ce,{},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/pages/EngineRoomCategories.tsx",lineNumber:21,columnNumber:15},void 0),tooltip:"Chi tiết"}];function Se(){const{openModal:a}=z(),[o,m]=g.useState({page:1,pageSize:se}),[p,k]=g.useState([]),[l,t]=g.useState({count:0}),[I,x]=g.useState(!1),[_,y]=g.useState({}),w=[{title:"Tên",dataIndex:"name",key:E.Name,fixed:"left",render:(n,c)=>s.jsxDEV("span",{className:"font-semibold text-sm cursor-pointer text-[#3D73D0]",onClick:()=>N(d.View,c),children:n??""},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/pages/EngineRoomCategories.tsx",lineNumber:40,columnNumber:21},this),sorter:!0},{title:"Tên viết tắt",dataIndex:"short_name",key:E.ShortName},{title:"Số điện thoại",dataIndex:"phone_number",key:"phone_number"},{title:"Cách liên lạc",dataIndex:"contact_method",key:"contact_method"},{title:"Đơn vị cấp trên quản lý",dataIndex:"org_id",key:"org_id",render:n=>(n==null?void 0:n.name)??""},{title:"Kinh độ (Độ N)",dataIndex:"longitude",key:"longitude"},{title:"Vĩ độ (Độ E)",dataIndex:"latitude",key:"latitude"},{title:"Đơn vị khai thác",dataIndex:"org_use_id",key:"org_use_id",render:n=>(n==null?void 0:n.name)??""},{title:"Đơn vị đảm bảo kỹ thuật",dataIndex:"org_technical_id",key:"org_technical_id",render:n=>(n==null?void 0:n.name)??""},{title:"Đơn vị hỗ trợ bảo đảm kỹ thuật",dataIndex:"org_support_id",key:"org_support_id",render:n=>(n==null?void 0:n.name)??""},{title:"Địa bàn",dataIndex:"ward_id",key:"ward_id",width:300,render:n=>ie(n)},{title:"Vị trí phòng máy",dataIndex:"address",key:"address",width:200},{title:"Diện tích PMC (m2)",dataIndex:"area",key:"area"},{title:"Số lượng máy chủ vật lý",dataIndex:"n_phy_server",key:"n_phy_server"},{title:"Số lượng máy chủ ảo",dataIndex:"n_vir_server",key:"n_vir_server"},{title:"Tổng số lượng ứng dụng, dịch vụ",dataIndex:"sum_app_service",key:"sum_app_service"},{title:"Năng lực xử lý CPU (GHz)",dataIndex:"ability_cpu",key:"ability_cpu"},{title:"Tổng dung lượng RAM (GB)",dataIndex:"sum_ram",key:"sum_ram"},{title:"Băng thông (Mbps)",dataIndex:"bandwidth",key:"bandwidth"},{title:"Tài nguyên lưu trữ (TB)",dataIndex:"n_storage",key:"n_storage"},{title:"Số lượng tủ RACK",dataIndex:"n_rack",key:"n_rack"},{title:"Mật độ tài nguyên lưu trữ (%)",dataIndex:"n_percent_density",key:"n_percent_density"},{title:"Hồ sơ kỹ thuật",dataIndex:"url_file_path",key:"url_file_path"},{title:"Có đảm bảo nguồn điện",dataIndex:"has_power_source",key:"has_power_source",render:n=>n?s.jsxDEV("span",{className:"text-green-600",children:"Có"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/pages/EngineRoomCategories.tsx",lineNumber:172,columnNumber:31},this):s.jsxDEV("span",{className:"text-red",children:"Không có"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/pages/EngineRoomCategories.tsx",lineNumber:172,columnNumber:76},this)},{title:"Có chống sét",dataIndex:"has_lighting_protect",key:"has_lighting_protect",render:n=>n?s.jsxDEV("span",{className:"text-green-600",children:"Có"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/pages/EngineRoomCategories.tsx",lineNumber:180,columnNumber:31},this):s.jsxDEV("span",{className:"text-red",children:"Không có"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/pages/EngineRoomCategories.tsx",lineNumber:180,columnNumber:76},this)},{title:"Có phòng cháy, chữa cháy",dataIndex:"has_fighting_protect",key:"has_fighting_protect",render:n=>n?s.jsxDEV("span",{className:"text-green-600",children:"Có"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/pages/EngineRoomCategories.tsx",lineNumber:188,columnNumber:31},this):s.jsxDEV("span",{className:"text-red",children:"Không có"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/pages/EngineRoomCategories.tsx",lineNumber:188,columnNumber:76},this)},{title:"Trạng thái",dataIndex:"is_enable",key:"is_enable",render:n=>n?s.jsxDEV("span",{className:"text-green-600",children:"Hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/pages/EngineRoomCategories.tsx",lineNumber:196,columnNumber:31},this):s.jsxDEV("span",{className:"text-red",children:"Không hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/pages/EngineRoomCategories.tsx",lineNumber:196,columnNumber:83},this)},{title:"Số thứ tự",dataIndex:"order_number",key:"order_number"},{title:"Đánh giá khả năng khai thác, vận hành (Điểm mạnh, yếu)",dataIndex:"comment",key:"comment"}].map(n=>({...n,key:(n==null?void 0:n.key)||oe()})),u=async(n,c,b)=>{try{x(!0);const e=await Promise.all([le({limit:c,page:n},b),he(b)]);e[1]&&t({count:e[1].count}),k(e[0]),x(!1)}catch(e){x(!1),console.log(e)}},C=n=>{a(s.jsxDEV(S,{id:n==null?void 0:n.id,action:d.View},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/pages/EngineRoomCategories.tsx",lineNumber:233,columnNumber:13},this),{width:"80vw",onModalClose(c){c!=null&&c.success?a(s.jsxDEV(S,{id:n==null?void 0:n.id,action:d.Update},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/pages/EngineRoomCategories.tsx",lineNumber:239,columnNumber:29},this),{width:"80vw",onModalClose(){f()}}):f()}})},N=(n,c)=>{console.log(n),n===d.View&&C(c)},f=()=>{u(o.page,o.pageSize,_)};return g.useEffect(()=>{u(1,o.pageSize,_)},[_]),s.jsxDEV("div",{className:"w-[900px]",children:s.jsxDEV(ae,{setFilter:y,setPagination:m,className:"mt-5",isReloadButton:!0,dataSource:[...p],columns:w,paginationCustom:{current:o.page,pageSize:o.pageSize,total:l==null?void 0:l.count},onChange:({current:n,pageSize:c})=>{m({page:n,pageSize:c}),u(o.page,o.pageSize,_)},actionList:xe,actionClick:N,isAction:!1,loading:I,scroll:{x:5e3},rowKey:"id",filterColumns:[E.Name],btnCreate:!0,handleCreate:()=>{a(s.jsxDEV(S,{action:d.Create},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/pages/EngineRoomCategories.tsx",lineNumber:297,columnNumber:21},this),{width:"80vw",onModalClose(n){n!=null&&n.success&&f()}})}},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/pages/EngineRoomCategories.tsx",lineNumber:268,columnNumber:9},this)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/it-categories/pages/EngineRoomCategories.tsx",lineNumber:267,columnNumber:12},this)}export{Se as default};
