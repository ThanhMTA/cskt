import{e as V,J as O,K as L,O as U,Q as q,R as G,t as I,v as z,w as K,x as B,r as m,j as n,k as H,q as J,F as Q,y as i,H as W,z as X,B as T,W as Y,E as Z,aQ as $}from"./index-DXrCg2vr.js";import{M as v}from"./ModalCategoryActionHeader-CMTsFAdF.js";import{I as A}from"./ItemsComponent-Ct2UsBCT.js";import{a as ee}from"./arrayToTree.min-Bpdh5Rxo.js";import{P as te}from"./PlusCircleOutlined-JzIS5LvP.js";import"./index-B0_H1u92.js";import"./index-CfEarsVi.js";import"./index-Bb5KQ1O1.js";const h={NAME:"Tên",SHORT_NAME:"Tên viết tắt",DESCRIPTION:"Ghi chú",GROUP_ID:"Nhóm nghiệp vụ",PARENT_ID:"Chuyên ngành cha",IS_ENABLE:"Trạng thái"},b="major_categories",F=(s,c)=>V(b,{...s,alias:{parentId:"parent_id",value:"id",title:"name"},fields:["*","parentId","value","title"],filter:c}),ae=(s,c)=>V("business_group",{...s,fields:["*"],filter:c}),se=async s=>{var p;return{count:(p=(await O(b,{aggregate:{countDistinct:"id"},query:{filter:s}}))[0].countDistinct)==null?void 0:p.id}},oe=(s,c)=>L(b,s,{fields:["*",{parent_id:["*"]},{group_id:["*"]}],filter:c}),ne=s=>U(b,{...s}),re=(s,c)=>q(b,s,{...c}),ie=s=>G(b,s),ce=({action:s,id:c,parentId:p})=>{const[d]=I.useForm(),N=z(),y=K(),{openMessage:g}=B(),[t,w]=m.useState(null),[u,M]=m.useState({parent:[],group:[]}),S=async()=>{const e=await Promise.all([F({},{}),ae({},{})]);M({parent:ee.arrayToTree([...e[0]],{dataField:null}),group:e[1]})},C=async()=>{try{const e=await oe(c,{});w(e)}catch(e){console.log("error: ",e)}},x=m.useMemo(()=>[{title:h.NAME,content:(t==null?void 0:t.name)||null,require:!0,dataIndex:"name",rules:[{required:!0,message:"Thông tin không được để trống!"}]},{title:h.SHORT_NAME,content:(t==null?void 0:t.short_name)||null,dataIndex:"short_name"},{title:h.PARENT_ID,content:(t==null?void 0:t.parent_id)||p||null,dataIndex:"parent_id"},{title:h.GROUP_ID,content:(t==null?void 0:t.group_id)||null,dataIndex:"group_id"},{title:"Ghi chú",content:(t==null?void 0:t.note)||null,dataIndex:"note"},{title:"Số thứ tự",content:(t==null?void 0:t.order_number)||null,dataIndex:"order_number"},{title:"Trạng thái",content:(t==null?void 0:t.is_enable)===void 0?!0:t==null?void 0:t.is_enable,dataIndex:"is_enable"}],[t,p]),j=e=>{if(["group_id"].includes(e))return W(u==null?void 0:u.group,"name","id")},_=()=>{if(s===i.View){f();return}else d.submit()},f=()=>{N.hide(),y.closeModal({success:!0})},a=async()=>{var e,l,E,D;try{N.show();const o=d.getFieldsValue(),R=(e=o==null?void 0:o.parent_id)!=null&&e.value?(l=o==null?void 0:o.parent_id)==null?void 0:l.value:o==null?void 0:o.parent_id,P=(E=o==null?void 0:o.group_id)!=null&&E.value?(D=o==null?void 0:o.group_id)==null?void 0:D.value:o==null?void 0:o.group_id;switch(s){case i.Update:await re(t==null?void 0:t.id,{...o,parent_id:R,group_id:P}),g({type:"success",content:"Cập nhật thành công"});break;case i.Create:await ne(o),g({type:"success",content:"Thêm mới thành công"}),d.resetFields();break;case i.View:break}f()}catch(o){console.log(o),g({type:"error",content:(o==null?void 0:o.message)||"Lỗi hệ thống"}),N.hide()}},r=async()=>{try{await ie(t==null?void 0:t.id),g({type:"success",content:"Xóa thành công"}),N.hide(),y.closeModal({})}catch(e){console.log(e),g({type:"error",content:(e==null?void 0:e.message)||"Lỗi hệ thống"})}};return m.useEffect(()=>{S(),c&&C()},[c]),n.jsxDEV(H,{...J,className:"flex",size:20,children:[n.jsxDEV(Q,{align:"center",justify:"space-between",className:"absolute bg-white left-0 right-0 px-6 pb-3 z-50",children:n.jsxDEV(v,{name:"chuyên ngành",action:s,hanldeFinish:_,handleDelete:r},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/MajorCategoryAction.tsx",lineNumber:207,columnNumber:9},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/MajorCategoryAction.tsx",lineNumber:202,columnNumber:7},void 0),n.jsxDEV(I,{form:d,className:"form-container bg-secondary p-5 rounded-primary mt-10 grid grid-cols-2 gap-2",onFinish:a,disabled:s===i.View,children:s===i.Update||s===i.Create?n.jsxDEV(n.Fragment,{children:x.map((e,l)=>n.jsxDEV(A,{title:e==null?void 0:e.title,rules:e==null?void 0:e.rules,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!0,dataIndex:e.dataIndex,treeField:{isSelect:(e==null?void 0:e.dataIndex)==="parent_id",dataSelect:u.parent},disable:!!(p&&(e==null?void 0:e.dataIndex)==="parent_id"),selectField:{isSelect:(e==null?void 0:e.dataIndex)==="group_id",dataSelect:j(e.dataIndex)},isNumberField:(e==null?void 0:e.dataIndex)==="order_number",isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"},l,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/MajorCategoryAction.tsx",lineNumber:219,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/MajorCategoryAction.tsx",lineNumber:216,columnNumber:11},void 0):n.jsxDEV(n.Fragment,{children:x.map((e,l)=>n.jsxDEV("div",{className:"flex flex-col pb-4",children:n.jsxDEV(A,{title:e==null?void 0:e.title,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!1,dataIndex:e.dataIndex,isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"},l,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/MajorCategoryAction.tsx",lineNumber:251,columnNumber:19},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/MajorCategoryAction.tsx",lineNumber:250,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/MajorCategoryAction.tsx",lineNumber:247,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/MajorCategoryAction.tsx",lineNumber:209,columnNumber:7},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/MajorCategoryAction.tsx",lineNumber:197,columnNumber:5},void 0)},k=ce,de=[{key:i.Create,icon:n.jsxDEV(te,{},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/MajorCategory.tsx",lineNumber:22,columnNumber:11},void 0),className:"border-none text-primary shadow-#0",title:"Thêm mới"}];function be(){const{openModal:s}=K(),[c,p]=m.useState([]),[d,N]=m.useState({count:0}),[y,g]=m.useState(!1),[t,w]=m.useState({page:1,pageSize:X}),[u,M]=m.useState({}),S=[{title:h.NAME,dataIndex:"name",fixed:"left",width:150,key:T.Name,render:(a,r)=>n.jsxDEV("span",{className:"text-primary cursor-pointer font-semibold",onClick:()=>{x(i.View,r)},children:a},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/MajorCategory.tsx",lineNumber:46,columnNumber:11},this)},{title:h.SHORT_NAME,dataIndex:"short_name",width:150,key:T.ShortName},{title:h.IS_ENABLE,dataIndex:"is_enable",width:150,render:a=>a?n.jsxDEV("span",{className:"text-green-600",children:"Hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/MajorCategory.tsx",lineNumber:75,columnNumber:41},this):n.jsxDEV("span",{className:"text-red",children:"Không hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/MajorCategory.tsx",lineNumber:75,columnNumber:93},this)},{title:h.DESCRIPTION,dataIndex:"note",width:380}].map(a=>({...a,key:(a==null?void 0:a.key)||Y()})),C=async(a,r,e)=>{try{g(!0);const l=await Promise.all([await F({limit:r,page:a},e),await se(e)]);p(l[0]),N(l[1]),g(!1)}catch{g(!1)}},x=(a,r)=>{switch(a){case i.View:_(r);break;case i.Create:j(r.id);break}},j=a=>{s(n.jsxDEV(k,{parentId:a,action:i.Create},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/MajorCategory.tsx",lineNumber:128,columnNumber:7},this),{width:"40vw",onModalClose(r){r!=null&&r.success&&f()}})},_=a=>{s(n.jsxDEV(k,{id:a.id,action:i.View},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/MajorCategory.tsx",lineNumber:143,columnNumber:7},this),{width:"40vw",onModalClose(r){r!=null&&r.success?s(n.jsxDEV(k,{id:a.id,action:i.Update},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/MajorCategory.tsx",lineNumber:149,columnNumber:15},this),{width:"40vw",onModalClose(){f()}}):f()}})},f=()=>{C(t.page,t.pageSize,u)};return m.useEffect(()=>{C(t.page,t.pageSize,u)},[t,u]),n.jsxDEV("div",{className:"w-[900px]",children:n.jsxDEV(Z,{total:(d==null?void 0:d.count)||0,className:"mt-5",setFilter:M,setPagination:w,isReloadButton:!1,dataSource:$(c),columns:S,actionList:de,rowClassName:"hover:bg-secondary group",isAction:!0,loading:y,actionWidth:100,paginationCustom:{current:t.page,pageSize:t.pageSize,total:d==null?void 0:d.count},onChange:({current:a,pageSize:r})=>{w({page:a,pageSize:r}),C(a,r,u)},actionClick:x,filterColumns:[T.Name],btnCreate:!0,handleCreate:()=>{s(n.jsxDEV(k,{action:i.Create},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/MajorCategory.tsx",lineNumber:204,columnNumber:13},this),{width:"40vw",onModalClose(a){a!=null&&a.success&&f()}})}},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/MajorCategory.tsx",lineNumber:175,columnNumber:7},this)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/MajorCategory.tsx",lineNumber:174,columnNumber:5},this)}export{de as ACTION_TABLE,be as default};
