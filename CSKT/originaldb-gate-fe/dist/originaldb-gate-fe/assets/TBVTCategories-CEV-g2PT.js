import{t as P,x as J,v as W,w as G,r as l,y as i,j as r,k as X,q as Y,F as $,aI as F,aJ as Q,aK as Z,aL as v,aM as ee,aN as se,H as q,aO as te,z as ne,B as U,W as oe,aP as D,E as re,aQ as ae,aR as ie,aS as ce,aT as de}from"./index-DXrCg2vr.js";import{F as ge}from"./ForceCategories.constant-D9uazZoj.js";import{g as me}from"./Country.action-CW-uQgoU.js";import{g as le}from"./SpeciesCategories.action-v1syKdr3.js";import{g as Te}from"./UnitCategories.action-DYvZMRMi.js";import{T as c}from"./TBVTCategories.enum-rX2XZBOr.js";import{M as pe}from"./ModalCategoryActionHeader-CMTsFAdF.js";import{I as H}from"./ItemsComponent-Ct2UsBCT.js";import{a as fe}from"./arrayToTree.min-Bpdh5Rxo.js";import{g as ue}from"./MajorCategories.action-CtvpKwzh.js";import{P as he}from"./PlusCircleOutlined-JzIS5LvP.js";import"./index-B0_H1u92.js";import"./index-CfEarsVi.js";import"./index-Bb5KQ1O1.js";const Ce=[{label:c.TB,value:c.TB},{label:c.CT,value:c.CT},{label:c.VT,value:c.VT},{label:c.HC,value:c.HC}],x={NAME:"Tên trang bị",DESC:"Mô tả",IS_ENABLE:"Trạng thái",CODE:"Mã trang bị, vật tư",ORIGIN_ID:"Định danh nước sản xuất",LENGTH:"Chiều dài trang bị",WIDTH:"Chiều rộng trang bị",HEIGHT:"Chiều cao trang bị",WEIGHT:"Khối lượng trang bị",UNIT:"Đơn vị tính",IS_PLANNING:"TB có nằm trong diện quy hoạch?",SPECIES_ID:"Chủng loại",PARENT_ID:"Thuộc nhóm TB",HAS_CHILD:"TB có chứa TB",MARJOR_CATEGORIES:"Thuộc chuyên ngành",AMOUNT:"Số lượng",SERIAL_NUMBER:"Serial number",TYPE:"Loại",ID_EX:"Mã định danh mở rộng do Bộ quốc phòng quy định ",CODE_EX:"Mã trang bị mở rộng do Bộ quốc phòng quy định",TREE_LEVEL:"Cấp mã trang bị khi dựng tree",TREE_PATH:"Đường dẫn của Tree"},be=({action:p,detail:s,type:u,parent_id:g=null,dataSource:E,setDataSource:f})=>{const[w]=P.useForm(),{openMessage:_}=J(),T=W(),V=G(),[h,I]=l.useState(null),[C,S]=l.useState({country:[],species:[],tbvt:[],units:[],major_categories:[]});let k="";switch(u){case c.TB:k="TBKT nhóm 1";break;case c.HC:k="TBVT ngành Hậu cần";break;case c.CT:k="TBVT ngành Chính trị";break;case c.VT:k="TBKT nhóm 2, VTKT";break}const M=async()=>{try{const e=await Promise.all([await me({},{}),await le({},{}),await F({},{_and:[{type:{_eq:u}}]}),await Te({},{}),await ue({},{})]);S({country:e[0],species:e[1],tbvt:e[2],units:e[3],major_categories:fe.arrayToTree([...e[4]],{dataField:null})})}catch{}},d=()=>{if(p===i.View){B();return}else w.submit()},B=()=>{T.hide(),V.closeModal({success:!0})},L=async()=>{const e=await Q(g);if(w.setFieldValue("code",e||""),g){const o=await Z(g,{});I(o||null)}},R=async()=>{var e;try{((e=s==null?void 0:s.children)==null?void 0:e.length)>0?_({type:"warning",content:"Đ/c không thể xóa khi đang tồn tại mã con!"}):(await v(s==null?void 0:s.id),f(o=>o.filter(b=>(b==null?void 0:b.id)!==(s==null?void 0:s.id))),_({type:"success",content:`Xóa ${ge.REASON} thành công`}),T.hide(),V.closeModal({}))}catch(o){console.log(o),_({type:"error",content:(o==null?void 0:o.message)||"Lỗi hệ thống"})}},y=async()=>{var e,o,b;try{T.show();const a=w.getFieldsValue(),K=(e=a==null?void 0:a.parent_id)!=null&&e.value?(o=a==null?void 0:a.parent_id)==null?void 0:o.value:a==null?void 0:a.parent_id,z=(h==null?void 0:h.tree_level)&&+(h==null?void 0:h.tree_level)+1,O=(b=a==null?void 0:a.major_categories)==null?void 0:b.map(m=>({major_categories_id:m!=null&&m.value?m.value:m}));switch(p){case i.Update:{const m=await se(s==null?void 0:s.id,{...a,code:void 0,parent_id:K,type:u,major_categories:O});f(N=>N.map(A=>(A==null?void 0:A.id)===(s==null?void 0:s.id)?m:A)),_({type:"success",content:"Cập nhật thành công"});break}case i.Create:{const m=await ee({...a,parent_id:K,type:u,tree_level:z,major_categories:O});m!=null&&m.code&&f([...E.map(N=>N&&((N==null?void 0:N.id)===K?{...N,has_child:!0}:N)),m]),_({type:"success",content:"Thêm mới thành công"}),w.resetFields();break}case i.View:break}B()}catch(a){console.log(a),_({type:"error",content:(a==null?void 0:a.message)||"Lỗi hệ thống"}),T.hide()}};l.useEffect(()=>{M(),p===i.Create&&L()},[]);const t=e=>{if(["parent_id"].includes(e))return q(C==null?void 0:C.tbvt,"name","id");if(["unit"].includes(e))return q(C==null?void 0:C.units,"name","name");if(["major_categories"].includes(e))return C.major_categories;if(["type"].includes(e))return Ce},n=l.useMemo(()=>[{title:x.CODE,content:(s==null?void 0:s.code)||null,dataIndex:"code",placeholder:"A.1.01.01.00.00.000"},{title:x.PARENT_ID,content:(s==null?void 0:s.parent)??g,dataIndex:"parent_id"},{title:x.NAME,content:(s==null?void 0:s.name)||null,require:!0,dataIndex:"name",rules:[{required:!0,message:"Thông tin không được để trống!"}]},{title:x.UNIT,content:(s==null?void 0:s.unit)||null,dataIndex:"unit"},{title:x.MARJOR_CATEGORIES,content:(s==null?void 0:s.major_categories)||[],dataIndex:"major_categories"},{title:"Số thứ tự",content:(s==null?void 0:s.order_number)||null,dataIndex:"order_number"},{title:x.IS_ENABLE,content:(s==null?void 0:s.is_enable)===void 0?!0:s==null?void 0:s.is_enable,dataIndex:"is_enable"}],[s]);return r.jsxDEV(X,{...Y,className:"flex",size:20,children:[r.jsxDEV($,{align:"center",justify:"space-between",className:"absolute bg-white left-0 right-0 px-6 pb-3 z-50",children:r.jsxDEV(pe,{name:k,action:p,hanldeFinish:d,handleDelete:R},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/TBVTCategoriesAction.tsx",lineNumber:327,columnNumber:9},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/TBVTCategoriesAction.tsx",lineNumber:322,columnNumber:7},void 0),r.jsxDEV(P,{form:w,className:"form-container bg-secondary p-5 rounded-primary mt-10 grid grid-cols-2 gap-2",onFinish:y,disabled:p===i.View,children:p===i.Update||p===i.Create?r.jsxDEV(r.Fragment,{children:n.map((e,o)=>r.jsxDEV(H,{title:e==null?void 0:e.title,placeholder:e==null?void 0:e.placeholder,rules:e==null?void 0:e.rules,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!0,disable:g!==null&&(e.dataIndex==="code"||e.dataIndex==="parent_id")||p===i.Update&&e.dataIndex==="code",dataIndex:e.dataIndex,selectField:{isSelect:(e==null?void 0:e.dataIndex)==="unit"||(e==null?void 0:e.dataIndex)==="parent_id",dataSelect:t(e.dataIndex)},treeField:{isMultiple:(e==null?void 0:e.dataIndex)==="major_categories",isSelect:(e==null?void 0:e.dataIndex)==="major_categories",dataSelect:t(e.dataIndex)},isNumberField:(e==null?void 0:e.dataIndex)==="order_number",isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"||(e==null?void 0:e.dataIndex)==="is_planning"||(e==null?void 0:e.dataIndex)==="has_child"},o,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/TBVTCategoriesAction.tsx",lineNumber:344,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/TBVTCategoriesAction.tsx",lineNumber:341,columnNumber:11},void 0):r.jsxDEV(r.Fragment,{children:n.map((e,o)=>r.jsxDEV("div",{className:"flex flex-col pb-4",children:r.jsxDEV(H,{title:e==null?void 0:e.title,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!1,dataIndex:e.dataIndex,isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"||(e==null?void 0:e.dataIndex)==="is_planning"||(e==null?void 0:e.dataIndex)==="has_child"},o,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/TBVTCategoriesAction.tsx",lineNumber:387,columnNumber:19},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/TBVTCategoriesAction.tsx",lineNumber:386,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/TBVTCategoriesAction.tsx",lineNumber:383,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/TBVTCategoriesAction.tsx",lineNumber:334,columnNumber:7},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/TBVTCategoriesAction.tsx",lineNumber:321,columnNumber:5},void 0)},j=be,Ne=[{key:i.Create,icon:r.jsxDEV(he,{},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/TBVTCategories.tsx",lineNumber:30,columnNumber:11},void 0),className:"text-primary",title:"Thêm mới"}];function Le(p){const{pathname:s}=te(),{openModal:u}=G(),[g,E]=l.useState([]),[f,w]=l.useState({count:0}),[_,T]=l.useState(!1),[V,h]=l.useState({page:1,pageSize:ne}),[I,C]=l.useState({}),[S,k]=l.useState([]),M=l.useMemo(()=>[{title:x.CODE,dataIndex:"code",render:(t,n)=>r.jsxDEV("span",{className:"font-semibold text-sm cursor-pointer text-[#3D73D0]",onClick:()=>y(i.View,n),children:t??""},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/TBVTCategories.tsx",lineNumber:60,columnNumber:15},this)},{title:x.NAME,dataIndex:"name",key:U.Name},{title:x.UNIT,dataIndex:"unit",render:t=>t}].map(t=>({...t,key:(t==null?void 0:t.key)||oe()})),[]);let d="";switch("/"+s.split("/")[1]){case D.ForceCategories:d=c.TB;break;case D.LogisticsCategories:d=c.HC;break;case D.PoliticsCategories:d=c.CT;break;case D.TechnicalCategories:d=c.VT;break}const B=async(t,n,e)=>{try{T(!0);let o={};JSON.stringify(e)==="{}"&&(o={parent_id:{_null:!0}});const b=await Promise.all([await F({limit:-1},{_and:[{type:{_eq:d}},{...o,...e}]}),await de({_and:[{type:{_eq:d}},e]})]);E(b[0]),w(b[1]),T(!1)}catch{T(!1)}},L=async t=>{if(!g.some(e=>e.parent_id===t))try{T(!0);const e=await F({limit:-1},{_and:[{type:{_eq:d}},{parent_id:t}]});E([...g,...e]),T(!1)}catch{T(!1)}},R=t=>{u(r.jsxDEV(j,{type:d,detail:t,action:i.View,dataSource:g,setDataSource:E},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/TBVTCategories.tsx",lineNumber:181,columnNumber:7},this),{width:"50vw",onModalClose(n){n!=null&&n.success&&u(r.jsxDEV(j,{type:d,detail:t,action:i.Update,dataSource:g,setDataSource:E},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/TBVTCategories.tsx",lineNumber:193,columnNumber:15},this),{width:"50vw",onModalClose(e){e!=null&&e.success}})}})},y=(t,n)=>{switch(t){case i.View:R(n);break;case i.Create:u(r.jsxDEV(j,{dataSource:g,setDataSource:E,type:d,parent_id:n==null?void 0:n.id,action:i.Create},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/TBVTCategories.tsx",lineNumber:226,columnNumber:11},this),{width:"50vw",onModalClose(e){}})}};return l.useEffect(()=>{B(V.page,V.pageSize,I)},[V,I]),r.jsxDEV("div",{className:d!==c.CT?"w-[900px]":"",children:r.jsxDEV(re,{hiddenIndex:!0,total:(f==null?void 0:f.count)||0,className:"mt-5",...p,setFilter:C,setPagination:h,isReloadButton:!1,dataSource:ae(g),columns:M,actionList:Ne,isAction:!0,actionWidth:100,rowClassName:"hover:bg-secondary group",loading:_,pagination:!1,paginationCustom:{current:V.page,pageSize:V.pageSize,total:f==null?void 0:f.count},onChange:({current:t,pageSize:n})=>{h({page:t,pageSize:n}),B(t,n,I)},actionClick:(t,n)=>y(t,n),filterColumns:[U.Name],btnCreate:!0,handleCreate:()=>{u(r.jsxDEV(j,{type:d,action:i.Create,dataSource:g,setDataSource:E},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/TBVTCategories.tsx",lineNumber:283,columnNumber:13},this),{width:"50vw",onModalClose(t){}})},expandable:{expandedRowKeys:S,onExpand:(t,n)=>{t?(L(n.id),k([...S,n.id])):k(S.filter(e=>e!==n.id))},expandIcon:({expanded:t,onExpand:n,record:e})=>e!=null&&e.has_child?t?r.jsxDEV(ce,{style:{marginRight:"10px",height:"10px",width:"10px"},rev:void 0,onClick:o=>{n(e,o)}},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/TBVTCategories.tsx",lineNumber:322,columnNumber:17},this):r.jsxDEV(ie,{style:{marginRight:"10px",height:"10px",width:"10px"},rev:void 0,onClick:o=>{n(e,o)}},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/TBVTCategories.tsx",lineNumber:314,columnNumber:17},this):null}},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/TBVTCategories.tsx",lineNumber:251,columnNumber:7},this)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/TBVTCategories.tsx",lineNumber:250,columnNumber:5},this)}export{Ne as ACTION_TABLE,Le as default};
