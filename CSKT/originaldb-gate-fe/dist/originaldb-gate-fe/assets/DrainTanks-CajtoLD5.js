import{e as q,J as z,O as P,Q as U,R as O,t as j,v as B,w as F,x as H,r as g,j as a,k as R,q as G,F as W,y as c,a_ as J,H as C,z as Q,B as A,W as X,E as Z,G as $}from"./index-DXrCg2vr.js";import{g as Y}from"./Ward.action-D2xWCgQ3.js";import{a as v}from"./DrainTankType.action-A724TnoC.js";import{M as ee}from"./ModalCategoryActionHeader-CMTsFAdF.js";import{I as K}from"./ItemsComponent-Ct2UsBCT.js";import"./index-B0_H1u92.js";import"./index-CfEarsVi.js";import"./index-Bb5KQ1O1.js";const N="drain_tanks",ne=(n,i)=>q(N,{...n,fields:["*"],filter:i}),te=async n=>{var l;return{count:(l=(await z(N,{aggregate:{countDistinct:"id"},query:{filter:n}}))[0].countDistinct)==null?void 0:l.id}},se=n=>P(N,{...n}),ae=(n,i)=>U(N,n,{...i}),oe=n=>O(N,n),re=({detail:n,action:i})=>{const[l]=j.useForm(),d=B(),T=F(),{openMessage:f}=H(),[r,p]=g.useState({organizations:[],wards:[],drainTankType:[]}),w=g.useMemo(()=>[{title:"Tên cống, bể",content:(n==null?void 0:n.name)||null,require:!0,dataIndex:"name",rules:[{required:!0,message:"Hãy nhập thông tin cho trường tên quốc gia"}]},{title:"Vị trí đặt cống, bể",content:(n==null?void 0:n.address)||null,dataIndex:"address"},{title:"Địa bàn",content:(n==null?void 0:n.ward_id)||null,dataIndex:"ward_id"},{title:"Đơn vị quản lý",content:(n==null?void 0:n.org_id)||null,dataIndex:"org_id"},{title:"Loại cống bể",content:(n==null?void 0:n.type_id)||null,dataIndex:"type_id"},{title:"Mô tả",content:(n==null?void 0:n.desc)||null,dataIndex:"desc"},{title:"Số thứ tự",content:(n==null?void 0:n.order_number)||null,dataIndex:"order_number"}],[n]),k=async()=>{try{const e=await Promise.all([await J({},{}),await Y({},{}),await v({},{})]);p({organizations:e[0],wards:e[1],drainTankType:e[2]})}catch{}},y=async()=>{try{await oe(n==null?void 0:n.id),f({type:"success",content:"Xóa thành công"}),b()}catch(e){console.log(e),f({type:"error",content:(e==null?void 0:e.message)||"Lỗi hệ thống"})}},_=()=>{if(i===c.View){b();return}else{h();return}},b=()=>{d.hide(),T.closeModal({success:!0})},h=async()=>{var e,s,o,u,x,E,I,V;try{d.show();let m=null;const t=l.getFieldsValue();switch(i){case c.Update:const M=(e=t==null?void 0:t.org_id)!=null&&e.value?(s=t==null?void 0:t.org_id)==null?void 0:s.value:t==null?void 0:t.org_id,L=(o=t==null?void 0:t.type_id)!=null&&o.value?(u=t==null?void 0:t.type_id)==null?void 0:u.value:t==null?void 0:t.type_id;m=(x=t==null?void 0:t.ward_id)!=null&&x.ward?(E=t==null?void 0:t.ward_id)==null?void 0:E.ward:null,await ae(n==null?void 0:n.id,{...t,org_id:M,type_id:L,ward_id:m}),f({type:"success",content:"Cập nhật thành công"});break;case c.Create:m=(I=t==null?void 0:t.ward_id)!=null&&I.ward?(V=t==null?void 0:t.ward_id)==null?void 0:V.ward:null,await se({...t,ward_id:m}),f({type:"success",content:"Thêm mới thành công"}),l.resetFields();break;case c.View:break}b()}catch(m){console.log(m),f({type:"error",content:(m==null?void 0:m.message)||"Lỗi hệ thống"}),d.hide()}},D=e=>{if(["org_id"].includes(e))return C(r==null?void 0:r.organizations,"name","id");if(["ward_id"].includes(e))return C(r==null?void 0:r.wards,"name","id");if(["type_id"].includes(e))return C(r==null?void 0:r.drainTankType,"name","id")};return g.useEffect(()=>{k()},[]),a.jsxDEV(R,{...G,className:"flex",size:20,children:[a.jsxDEV(W,{align:"center",justify:"space-between",className:"absolute bg-white left-0 right-0 px-6 pb-3 z-50",children:a.jsxDEV(ee,{name:"cống bể",action:i,hanldeFinish:_,handleDelete:y},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/DrainTanksAction.tsx",lineNumber:212,columnNumber:9},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/DrainTanksAction.tsx",lineNumber:207,columnNumber:7},void 0),a.jsxDEV(j,{form:l,className:"form-container bg-secondary p-5 rounded-primary mt-10 grid grid-cols-2 gap-2",onFinish:h,requiredMark:!1,children:i===c.Update||i===c.Create?a.jsxDEV(a.Fragment,{children:w.map((e,s)=>a.jsxDEV(K,{title:e==null?void 0:e.title,rules:e==null?void 0:e.rules,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!0,addressField:(e==null?void 0:e.dataIndex)==="ward_id",selectField:{isSelect:(e==null?void 0:e.dataIndex)==="org_id"||(e==null?void 0:e.dataIndex)==="type_id",dataSelect:D(e==null?void 0:e.dataIndex)},isNumberField:(e==null?void 0:e.dataIndex)==="order_number",dataIndex:e.dataIndex},s,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/DrainTanksAction.tsx",lineNumber:321,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/DrainTanksAction.tsx",lineNumber:318,columnNumber:11},void 0):a.jsxDEV(a.Fragment,{children:w.map((e,s)=>a.jsxDEV("div",{className:"flex flex-col pb-4",children:a.jsxDEV(K,{title:e==null?void 0:e.title,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!1,dataIndex:e.dataIndex},s,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/DrainTanksAction.tsx",lineNumber:346,columnNumber:19},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/DrainTanksAction.tsx",lineNumber:345,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/DrainTanksAction.tsx",lineNumber:342,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/DrainTanksAction.tsx",lineNumber:214,columnNumber:7},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/DrainTanksAction.tsx",lineNumber:202,columnNumber:5},void 0)},S=re,ie=[{key:c.View,icon:a.jsxDEV($,{},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/DrainTanks.tsx",lineNumber:23,columnNumber:11},void 0),tooltip:"Chi tiết"}];function be(){const{openModal:n}=F(),[i,l]=g.useState([]),[d,T]=g.useState({count:0}),[f,r]=g.useState(!1),[p,w]=g.useState({page:1,pageSize:Q}),[k,y]=g.useState({}),_=[{title:"Tên cống, bể",dataIndex:"name",width:200,fixed:"left",key:A.Name,render:(s,o)=>a.jsxDEV("span",{className:"font-semibold text-sm cursor-pointer text-[#3D73D0]",onClick:()=>D(c.View,o),children:s??""},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/DrainTanks.tsx",lineNumber:49,columnNumber:11},this)},{title:"Vị trí đặt cống, bể",dataIndex:"address",width:300},{title:"Đơn vị quản lý",dataIndex:"org_id",width:330},{title:"Loại cống bể",dataIndex:"type_id",width:330},{title:"Địa bàn",dataIndex:"ward_id",width:330},{title:"Trạng thái",dataIndex:"is_enable",width:150,render:s=>s?a.jsxDEV("span",{className:"text-green-600",children:"Hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/DrainTanks.tsx",lineNumber:84,columnNumber:11},this):a.jsxDEV("span",{className:"text-red",children:"Không hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/DrainTanks.tsx",lineNumber:86,columnNumber:11},this)}].map(s=>({...s,key:(s==null?void 0:s.key)||X()})),b=async(s,o,u)=>{try{r(!0);const x=await Promise.all([await ne({limit:o,page:s},u),await te({})]);l(x[0]),T(x[1]),r(!1)}catch{r(!1)}},h=s=>{n(a.jsxDEV(S,{detail:s,action:c.View},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/DrainTanks.tsx",lineNumber:112,columnNumber:15},this),{width:"40vw",onModalClose(o){o!=null&&o.success&&n(a.jsxDEV(S,{detail:s,action:c.Update},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/DrainTanks.tsx",lineNumber:116,columnNumber:21},this),{width:"40vw",onModalClose(u){u!=null&&u.success&&e()}})}})},D=(s,o)=>{console.log(s),s===c.View&&h(o)},e=()=>{b(p.page,p.pageSize,k)};return g.useEffect(()=>{b(p.page,p.pageSize,k)},[k]),a.jsxDEV("div",{className:"w-[900px]",children:a.jsxDEV(Z,{total:(d==null?void 0:d.count)||0,className:"mt-5",isReloadButton:!1,dataSource:i,columns:_,actionList:ie,isAction:!1,loading:f,setPagination:w,setFilter:y,paginationCustom:{current:p.page,pageSize:p.pageSize,total:d==null?void 0:d.count},onChange:({current:s,pageSize:o})=>{w({page:s,pageSize:o}),b(s,o,k)},actionClick:D,filterColumns:[A.Name],btnCreate:!0,handleCreate:()=>{n(a.jsxDEV(S,{action:c.Create},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/DrainTanks.tsx",lineNumber:170,columnNumber:21},this),{width:"40vw",onModalClose(s){s!=null&&s.success&&e()}})}},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/DrainTanks.tsx",lineNumber:145,columnNumber:7},this)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/DrainTanks.tsx",lineNumber:144,columnNumber:5},this)}export{ie as ACTION_TABLE,be as default};
