import{e as Z,J as l,O as v,Q as nn,R as tn,t as L,v as on,w as sn,x as rn,r as N,j as i,k as en,q as cn,F as dn,y as a,U as _n,H as h}from"./index-DXrCg2vr.js";import{g as mn}from"./Ward.action-D2xWCgQ3.js";import{g as an}from"./StationFunction.action-BrqCOwjU.js";import{g as gn}from"./StationType.action-vp6QDcJD.js";import{M as pn}from"./ModalCategoryActionHeader-CMTsFAdF.js";import{I as U}from"./ItemsComponent-Ct2UsBCT.js";import{a as fn}from"./arrayToTree.min-Bpdh5Rxo.js";const f="workstations",In=async(r,t)=>(await Z(f,{...r,fields:["*",{org_id:["*"]},{org_support_id:["*"]},{org_technical_id:["*"]},{org_use_id:["*"]},{type_id:["*"]},{ward_id:["*",{district_id:["*",{province_id:["*"]}]}]},{parent_id:["*"]}],filter:t})).map(e=>{var I;return{...e,parent_id:(I=e==null?void 0:e.parent_id)==null?void 0:I.id,parent:e==null?void 0:e.parent_id}}),yn=async r=>{var m;return{count:(m=(await l(f,{aggregate:{countDistinct:"id"},query:{filter:r}}))[0].countDistinct)==null?void 0:m.id}},hn=r=>v(f,{...r}),xn=(r,t)=>nn(f,r,{...t}),Nn=r=>tn(f,r),s={NAME:"Tên trạm",CODE:"",SHORT_NAME:"Tên viết tắt",SYMBOL:"Biểu tượng",PHONE_NUMBER:"Số điện thoại",CONTACT_METHOD:"Cách liên lạc",ORG_ID:"Đơn vị quản lý",ORG_USE_ID:"Đơn vị khai thác",ORG_TECHNICAL_ID:"Đơn vị bảo đảm kỹ thuật",ORG_SUPPORT_ID:"Đơn vị hỗ trợ bảo đảm kỹ thuật",WARD_ID:"Mã phường/ xã",PARENT_ID:"Thuộc tổng trạm",FUNCTION_ID:"Chức năng trạm",AREA:"Diện tích",ADDRESS:"Địa chỉ trạm",COORDINATES:"Tọa độ",LONGITUDE:"Kinh độ (Độ N)",LATITUDE:"Vĩ độ (Độ E)",TYPE_ID:"Loại trạm",FILE_PATH:"Đường dẫn file Hồ sơ kỹ thuật trạm",DESC:"Mô tả",IS_ENABLE:"Trạng thái"},Tn=({action:r,detail:t,parent_id:m})=>{const[g]=L.useForm(),e=on(),I=sn(),{openMessage:p}=rn(),[c,V]=N.useState({stationParent:[],organizations:[],stationFunctions:[],wards:[],stationType:[]}),T=N.useMemo(()=>[{title:s.NAME,content:(t==null?void 0:t.name)||null,require:!0,dataIndex:"name",rules:[{required:!0,message:"Thông tin không được để trống!"}]},{title:s.SHORT_NAME,content:(t==null?void 0:t.short_name)||null,dataIndex:"short_name"},{title:s.PARENT_ID,content:m||(t==null?void 0:t.parent)||null,dataIndex:"parent_id"},{title:s.PHONE_NUMBER,content:(t==null?void 0:t.phone_number)||null,dataIndex:"phone_number"},{title:s.WARD_ID,content:(t==null?void 0:t.ward_id)||null,dataIndex:"ward_id"},{title:s.ADDRESS,content:(t==null?void 0:t.address)||null,dataIndex:"address"},{title:s.ORG_USE_ID,content:(t==null?void 0:t.org_use_id)||null,dataIndex:"org_use_id"},{title:s.ORG_TECHNICAL_ID,content:(t==null?void 0:t.org_technical_id)||null,dataIndex:"org_technical_id"},{title:s.ORG_SUPPORT_ID,content:(t==null?void 0:t.org_support_id)||null,dataIndex:"org_support_id"},{title:s.ORG_ID,content:(t==null?void 0:t.org_id)||null,dataIndex:"org_id"},{title:s.CONTACT_METHOD,content:(t==null?void 0:t.contact_method)||null,dataIndex:"contact_method"},{title:s.FUNCTION_ID,content:(t==null?void 0:t.function_id)||null,dataIndex:"function_id"},{title:s.AREA,content:(t==null?void 0:t.area)||null,dataIndex:"area"},{title:s.LATITUDE,content:(t==null?void 0:t.latitude)||null,dataIndex:"latitude"},{title:s.LONGITUDE,content:(t==null?void 0:t.longitude)||null,dataIndex:"longitude"},{title:s.TYPE_ID,content:(t==null?void 0:t.type_id)||null,dataIndex:"type_id"},{title:s.FILE_PATH,content:(t==null?void 0:t.file_path)||null,dataIndex:"file_path"},{title:s.DESC,content:(t==null?void 0:t.desc)||null,dataIndex:"desc"},{title:"Số thứ tự",content:(t==null?void 0:t.order_number)||null,dataIndex:"order_number"},{title:"Trạng thái",content:(t==null?void 0:t.is_enable)===void 0?!0:t==null?void 0:t.is_enable,dataIndex:"is_enable"}],[t]),H=async()=>{const n=await Promise.all([await _n({}),await mn({},{}),await an({},{}),await gn({},{}),await In({},{})]);V({organizations:fn.arrayToTree([...n[0]],{dataField:null}),wards:n[1],stationFunctions:n[2],stationType:n[3],stationParent:n[4]})},j=()=>{if(r===a.View){x();return}else g.submit()},x=()=>{e.hide(),I.closeModal({success:!0})},K=async()=>{var n,_,D,b,E,k,w,A,S,y,O,C,R,F,u,P,W,M;try{e.show();let d=null;const o=g.getFieldsValue();switch(r){case a.Update:const z=(n=o==null?void 0:o.org_id)!=null&&n.value?(_=o==null?void 0:o.org_id)==null?void 0:_.value:o==null?void 0:o.org_id,B=(D=o==null?void 0:o.parent_id)!=null&&D.value?(b=o==null?void 0:o.parent_id)==null?void 0:b.value:o==null?void 0:o.parent_id,Y=(E=o==null?void 0:o.org_use_id)!=null&&E.value?(k=o==null?void 0:o.org_use_id)==null?void 0:k.value:o==null?void 0:o.org_use_id,J=(w=o==null?void 0:o.org_technical_id)!=null&&w.value?(A=o==null?void 0:o.org_technical_id)==null?void 0:A.value:o==null?void 0:o.org_technical_id,Q=(S=o==null?void 0:o.org_support_id)!=null&&S.value?(y=o==null?void 0:o.org_support_id)==null?void 0:y.value:o==null?void 0:o.org_support_id,X=(O=o==null?void 0:o.type_id)!=null&&O.value?(C=o==null?void 0:o.type_id)==null?void 0:C.value:o==null?void 0:o.type_id,$=(R=o==null?void 0:o.function_id)!=null&&R.value?(F=o==null?void 0:o.function_id)==null?void 0:F.value:o==null?void 0:o.function_id;d=(u=o==null?void 0:o.ward_id)!=null&&u.ward?(P=o==null?void 0:o.ward_id)==null?void 0:P.ward:null,await xn(t==null?void 0:t.id,{...o,org_id:z,org_use_id:Y,org_technical_id:J,org_support_id:Q,type_id:X,function_id:$,parent_id:B,ward_id:d}),p({type:"success",content:"Cập nhật thành công"});break;case a.Create:d=(W=o==null?void 0:o.ward_id)!=null&&W.ward?(M=o==null?void 0:o.ward_id)==null?void 0:M.ward:null,await hn({...o,ward_id:d}),p({type:"success",content:"Thêm mới thành công"}),g.resetFields();break;case a.View:break}x()}catch(d){console.log(d),p({type:"error",content:(d==null?void 0:d.message)||"Lỗi hệ thống"}),e.hide()}},G=async()=>{try{await Nn(t==null?void 0:t.id),p({type:"success",content:"Xóa thành công"}),x()}catch(n){console.log(n),p({type:"error",content:(n==null?void 0:n.message)||"Lỗi hệ thống"})}},q=n=>{if(["type_id"].includes(n))return h(c==null?void 0:c.stationType,"name","id");if(["parent_id"].includes(n))return t?h(c.stationParent,"name","id").filter(_=>_.value!==(t==null?void 0:t.id)):h(c.stationParent,"name","id");if(["function_id"].includes(n))return h(c==null?void 0:c.stationFunctions,"name","id")};return N.useEffect(()=>{H()},[]),i.jsxDEV(en,{...cn,className:"flex",size:20,children:[i.jsxDEV(dn,{align:"center",justify:"space-between",className:"absolute bg-white left-0 right-0 px-6 pb-3 z-50",children:i.jsxDEV(pn,{name:"trạm thông tin",action:r,hanldeFinish:j,handleDelete:G},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/WorkstationsAction.tsx",lineNumber:305,columnNumber:9},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/WorkstationsAction.tsx",lineNumber:300,columnNumber:7},void 0),i.jsxDEV(L,{form:g,className:"form-container bg-secondary p-5 rounded-primary mt-10 grid grid-cols-4 gap-4",onFinish:K,disabled:r===a.View,children:r===a.Update||r===a.Create?i.jsxDEV(i.Fragment,{children:T.map((n,_)=>i.jsxDEV(U,{title:n==null?void 0:n.title,rules:n==null?void 0:n.rules,content:n==null?void 0:n.content,require:n==null?void 0:n.require,statusUpdate:!0,dataIndex:n.dataIndex,suffix:n.dataIndex==="area"?"m²":null,disable:!!(m&&(n==null?void 0:n.dataIndex)==="parent_id"),selectField:{isSelect:(n==null?void 0:n.dataIndex)==="type_id"||(n==null?void 0:n.dataIndex)==="function_id"||(n==null?void 0:n.dataIndex)==="parent_id",dataSelect:q(n==null?void 0:n.dataIndex)},treeField:{isSelect:(n==null?void 0:n.dataIndex)==="org_id"||(n==null?void 0:n.dataIndex)==="org_use_id"||(n==null?void 0:n.dataIndex)==="org_support_id"||(n==null?void 0:n.dataIndex)==="org_technical_id",dataSelect:c.organizations},isNumberField:(n==null?void 0:n.dataIndex)==="area"||(n==null?void 0:n.dataIndex)==="order_number",addressField:(n==null?void 0:n.dataIndex)==="ward_id",isRadioField:(n==null?void 0:n.dataIndex)==="is_enable"},_,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/WorkstationsAction.tsx",lineNumber:322,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/WorkstationsAction.tsx",lineNumber:319,columnNumber:11},void 0):i.jsxDEV(i.Fragment,{children:T.map((n,_)=>i.jsxDEV("div",{className:"flex flex-col pb-4",children:i.jsxDEV(U,{title:n==null?void 0:n.title,content:n==null?void 0:n.content,require:n==null?void 0:n.require,statusUpdate:!1,dataIndex:n.dataIndex,isRadioField:(n==null?void 0:n.dataIndex)==="is_enable"},_,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/WorkstationsAction.tsx",lineNumber:364,columnNumber:19},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/WorkstationsAction.tsx",lineNumber:363,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/WorkstationsAction.tsx",lineNumber:360,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/WorkstationsAction.tsx",lineNumber:312,columnNumber:7},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/WorkstationsAction.tsx",lineNumber:299,columnNumber:5},void 0)},On=Tn;export{On as W,In as g,yn as m};
