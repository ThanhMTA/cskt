import{e as q,cB as x,t as A,v as $,w as G,i as J,f as W,x as Y,r as C,cA as b,j as s,k as X,q as Z,S as R,F as v,ax as nn,y as en,cJ as tn,cK as rn,cL as sn,cM as cn,U as on,cN as an,aQ as dn,H as mn}from"./index-DXrCg2vr.js";import{I as gn}from"./ItemsComponent-Ct2UsBCT.js";import{g as hn}from"./Ward.action-D2xWCgQ3.js";import{g as _n}from"./MajorCategories.action-CtvpKwzh.js";import{a as K}from"./arrayToTree.min-Bpdh5Rxo.js";const D="technical_type",fn=async(r,_)=>{let t={_and:[{..._}]};return q(D,{alias:{parentId:"parent_id",value:"id",key:"id",title:"name"},fields:["id","key","name","value","title","short_name","parentId","parent_id"],filter:t,limit:-1,sort:["order_number"]})},Sn=async(r,_)=>q(D,{...r,fields:["*"],filter:_,sort:["order_number"]});var k=(r=>(r.CHINH_THUC="CHINH_THUC",r.KIEM_NHIEM="KIEM_NHIEM",r))(k||{});const pn=[{label:"Chiến dịch",value:x.CHIEN_DICH},{label:"Chiến lược",value:x.CHIEN_LUOC},{label:"Chiến thuật",value:x.CHIEN_THUAT}],kn=[{label:"1",value:1},{label:"2",value:2},{label:"3",value:3},{label:"4",value:4},{label:"5",value:5}],ln=[{label:"Chính thức",value:k.CHINH_THUC},{label:"Kiêm nhiệm",value:k.KIEM_NHIEM}];var w=(r=>(r.CSKT_K1="CSKT_K1",r.CSKT_DV="CSKT_DV",r))(w||{});const Tn=({modalType:r,type_id:_,detail:t,action:H})=>{const[m]=A.useForm(),I=$(),F=G(),{availableRoles:g}=J(),{userInfo:N}=W(),{openMessage:E}=Y(),[un,z]=C.useState([]),[o,O]=C.useState({organizations:[],wards:[],type:[],majors:[],technical_orgs:[]}),[L,j]=C.useState(!1),P=()=>{m.submit()},M=async()=>{var e,a,f,p,l,T,i,y;try{const n=m.getFieldsValue(),h=((e=n==null?void 0:n.ward_id)==null?void 0:e.ward)||null;if(!h){m.setFields([{name:"ward_id",errors:["Thông tin không được để trống!"]}]);return}if(I.show(),H===en.Create){let d=(n==null?void 0:n.technical_id)||null;if(!d){const c={name:n==null?void 0:n.name,code:n==null?void 0:n.code,address:n==null?void 0:n.address,description:n==null?void 0:n.description,is_offical:n==null?void 0:n.is_offical,org_manage_id:n==null?void 0:n.org_manage_id,ward_id:h};d=(await tn(c)).id}const u={technical_id:d,type_id:n==null?void 0:n.type_id,level:n==null?void 0:n.level,major_id:n==null?void 0:n.major_id,dvt:n==null?void 0:n.dvt,transport:n==null?void 0:n.transport,note:n==null?void 0:n.note};await rn(u),E({type:"success",content:"Thêm mới thành công"})}else{const d={org_manage_id:(a=n==null?void 0:n.org_manage_id)!=null&&a.value?(f=n==null?void 0:n.org_manage_id)==null?void 0:f.value:n==null?void 0:n.org_manage_id,code:n==null?void 0:n.code,address:n==null?void 0:n.address,description:n==null?void 0:n.description,name:n==null?void 0:n.name,is_offical:n==null?void 0:n.is_offical,ward_id:h,tbvt_categories:t==null?void 0:t.tbvt_categories,personal_identifies:t==null?void 0:t.personal_identifies},u={type_id:(p=n==null?void 0:n.type_id)!=null&&p.value?(l=n==null?void 0:n.type_id)==null?void 0:l.value:n==null?void 0:n.type_id,major_id:(T=n==null?void 0:n.major_id)!=null&&T.value?(i=n==null?void 0:n.major_id)==null?void 0:i.value:n==null?void 0:n.major_id,level:n==null?void 0:n.level,dvt:n==null?void 0:n.dvt,transport:n==null?void 0:n.transport,note:n==null?void 0:n.note};await Promise.all([sn(t==null?void 0:t.id,u),cn((y=t.technical_id)==null?void 0:y.id,d)])}m.resetFields(),V()}catch(n){console.error(n),E({type:"error",content:(n==null?void 0:n.message)||"Lỗi hệ thống"})}finally{I.hide()}},V=()=>{I.hide(),F.closeModal({success:!0})},U=async()=>{var e,a,f,p,l,T;try{let i={};if(((a=(e=g==null?void 0:g[0])==null?void 0:e.role_id)==null?void 0:a.name)===w.CSKT_K1)i={_or:[{_and:[{code:{_contains:"43"}},{is_enable:!0}]},{_and:[{code:{_contains:"70"}},{is_enable:!0}]}]};else if(((p=(f=g==null?void 0:g[0])==null?void 0:f.role_id)==null?void 0:p.name)===w.CSKT_DV){const c=(l=N==null?void 0:N.personal_id)==null?void 0:l.org_id;i={_and:[{tree_path:{_contains:((T=c==null?void 0:c.parent_id)==null?void 0:T.tree_path)||(c==null?void 0:c.tree_path)}},{is_enable:!0}]}}j(!0);const[y,n,h,d,u]=await Promise.all([on({...i}),hn({},{}),fn({},{}),_n({},{}),an({limit:-1},{})]);z(h),O({organizations:dn(y),wards:n,type:K.arrayToTree([...h],{dataField:null}),majors:K.arrayToTree([...d],{dataField:null}),technical_orgs:u})}catch(i){console.error("Failed to fetch data:",i)}finally{j(!1)}},B=[{title:`Tên ${{[b.CSBD]:"cơ sở kỹ thuật",[b.ToBD]:"tổ BĐKTcđ"}[r]||"trạm CQĐT"}`,content:(t==null?void 0:t.name)??null,require:!0,dataIndex:"name",rules:[{required:!0,message:"Thông tin không được để trống!"}]},{title:"Ký hiệu",content:(t==null?void 0:t.code)??null,require:!1,dataIndex:"code"},{title:"Loại hình cơ sở kỹ thuật",content:(t==null?void 0:t.type_id)??(_||null),require:!1,dataIndex:"type_id",rules:[{required:!0,message:"Thông tin không được để trống!"}]},{title:"Phân cấp",content:(t==null?void 0:t.level)??x.CHIEN_THUAT,require:!1,dataIndex:"level",rules:[{required:!0,message:"Thông tin không được để trống!"}]},{title:"Đơn vị quản lý",content:(t==null?void 0:t.org_manage_id)??null,require:!1,dataIndex:"org_manage_id",rules:[{required:!0,message:"Thông tin không được để trống!"}]},{title:"Chuyên ngành",content:(t==null?void 0:t.major_id)??null,require:!1,dataIndex:"major_id",rules:[{required:!0,message:"Thông tin không được để trống!"}]},{title:"Địa giới hành chính",content:(t==null?void 0:t.ward_id)??null,require:!0,dataIndex:"ward_id",rules:[{required:!0,message:"Thông tin không được để trống!"}]},{title:"Số nhà, tên đường",content:(t==null?void 0:t.address)??null,require:!1,dataIndex:"address"},{title:"Hình thức",content:(t==null?void 0:t.is_offical)??null,require:!0,dataIndex:"is_offical",rules:[{required:!0,message:"Thông tin không được để trống!"}]},{title:"Đơn vị tính",content:(t==null?void 0:t.dvt)??null,require:!1,dataIndex:"dvt"},{title:"Phương tiện cơ động",content:(t==null?void 0:t.transport)??null,require:!1,dataIndex:"transport"},{title:"Ghi chú",content:(t==null?void 0:t.note)??null,require:!1,dataIndex:"note"},{title:"",content:(t==null?void 0:t.technical_id)??null,require:!1,hidden:!0,dataIndex:"technical_id"}],Q=e=>{switch(e){case"major_id":return"Chọn chuyên ngành";case"org_manage_id":return"Chọn đơn vị";case"type_id":return"Chọn loại CSKT";default:return"Chọn đơn vị"}},S=e=>{if(["ward_id"].includes(e))return mn(o==null?void 0:o.wards,"name","id");if(["major_id"].includes(e))return o.majors;if(["type_id"].includes(e))return o.type;if(["level"].includes(e))return pn;if(["is_offical"].includes(e))return ln;if(["org_manage_id"].includes(e))return o.organizations;if(["name"].includes(e))return o.technical_orgs};return C.useEffect(()=>{U()},[]),s.jsxDEV(X,{...Z,className:"flex",size:20,children:L?s.jsxDEV(R,{},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/techinical-organization/components/TechnicalAssuranceAction.tsx",lineNumber:347,columnNumber:17},void 0):s.jsxDEV(s.Fragment,{children:[s.jsxDEV(v,{align:"center",justify:"space-between",className:"absolute bg-white left-0 right-0 px-6 pb-3 z-50",children:[s.jsxDEV("p",{className:"modal-title",children:`${t?"Chỉnh sửa":"Thêm mới"} ${{[b.CSBD]:"cơ sở kỹ thuật",[b.ToBD]:"tổ BĐKTcđ"}[r]||"trạm CQĐT"}`},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/techinical-organization/components/TechnicalAssuranceAction.tsx",lineNumber:355,columnNumber:25},void 0),s.jsxDEV(nn,{type:"primary",onClick:P,children:"Lưu thông tin"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/techinical-organization/components/TechnicalAssuranceAction.tsx",lineNumber:360,columnNumber:25},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/techinical-organization/components/TechnicalAssuranceAction.tsx",lineNumber:350,columnNumber:21},void 0),s.jsxDEV(A,{form:m,className:"form-container bg-secondary p-5 rounded-primary mt-10 grid grid-cols-2 gap-2",onFinish:M,children:B.map((e,a)=>s.jsxDEV(gn,{hidden:e==null?void 0:e.hidden,title:e==null?void 0:e.title,rules:e==null?void 0:e.rules,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!0,dataIndex:e.dataIndex,treeField:{isSelect:(e==null?void 0:e.dataIndex)==="org_manage_id"||(e==null?void 0:e.dataIndex)==="type_id"||(e==null?void 0:e.dataIndex)==="major_id",dataSelect:S(e==null?void 0:e.dataIndex),placeholder:Q(e==null?void 0:e.dataIndex)},selectField:{isSelect:(e==null?void 0:e.dataIndex)==="level"||(e==null?void 0:e.dataIndex)==="is_offical",dataSelect:S(e==null?void 0:e.dataIndex)},autoCompleteField:{formData:m,isSelect:(e==null?void 0:e.dataIndex)==="name",dataSelect:S(e==null?void 0:e.dataIndex)},addressField:(e==null?void 0:e.dataIndex)==="ward_id"},a,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/techinical-organization/components/TechnicalAssuranceAction.tsx",lineNumber:369,columnNumber:33},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/techinical-organization/components/TechnicalAssuranceAction.tsx",lineNumber:362,columnNumber:21},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/techinical-organization/components/TechnicalAssuranceAction.tsx",lineNumber:349,columnNumber:17},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/techinical-organization/components/TechnicalAssuranceAction.tsx",lineNumber:342,columnNumber:9},void 0)},wn=Tn;export{w as A,k as O,kn as Q,wn as T,Sn as a,fn as g};
