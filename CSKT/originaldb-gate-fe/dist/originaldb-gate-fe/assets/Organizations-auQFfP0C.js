import{t as R,v as P,w as K,x as U,r as m,y as r,j as a,k as q,q as B,F as H,aV as W,aW as X,U as G,aX as Q,aY as Y,aZ as Z,H as $,z as J,B as y,V as v,W as ee,E as te,aQ as se,aR as ne,aS as ae,a_ as j,a$ as ie}from"./index-DXrCg2vr.js";import{g as oe}from"./Ward.action-D2xWCgQ3.js";import{g as re}from"./MilitaryDistrict.action-DAlwc088.js";import{M as ce}from"./ModalCategoryActionHeader-CMTsFAdF.js";import{I as F}from"./ItemsComponent-Ct2UsBCT.js";import{a as de}from"./arrayToTree.min-Bpdh5Rxo.js";import{P as me}from"./PlusCircleOutlined-JzIS5LvP.js";import"./index-B0_H1u92.js";import"./index-CfEarsVi.js";import"./index-Bb5KQ1O1.js";const c={NAME:"Tên đơn vị",DESC:"Mô tả",SHORT_NAME:"Tên tắt đơn vị",IS_ENABLE:"Trạng thái",CODE:"Mã đơn vị",PARENT_ID:"Đơn vị trực thuộc",WARD_ID:"Địa chỉ",MILITARY_DISTRIC_ID:"Thuộc quân khu",ATTRIBUTE:"Tính chất đơn vị",TREE_LEVEL:"Cấp mã trang bị khi dựng tree",TREE_PATH:"Đường dẫn của cây",ID_EX:"Mã định danh mở rộng do BQP quy định",CODE_EX:"Mã trang bị mở rộng do BQP quy định"},le=({action:d,detail:t,parent_id:g})=>{const[f]=R.useForm(),x=P(),T=K(),{openMessage:u}=U(),[l,I]=m.useState(null),[b,p]=m.useState({organizations:[],militaryDistrict:[],wards:[]}),C=async e=>{const o=await W(e);if(f.setFieldValue("code",o||""),g){const E=await X(g,{});I(E||null)}},w=async()=>{const e=await Promise.all([await G({}),await oe({},{}),await re({},{})]);p({organizations:de.arrayToTree([...e[0]],{dataField:null}),wards:e[1],militaryDistrict:e[2]})},D=async()=>{var e,o,E,O,A,z;try{x.show();let h=null;const n=f.getFieldsValue(),V=(e=n==null?void 0:n.parent_id)!=null&&e.value?(o=n==null?void 0:n.parent_id)==null?void 0:o.value:n==null?void 0:n.parent_id,M=(E=n==null?void 0:n.military_distric_id)!=null&&E.value?(O=n==null?void 0:n.military_distric_id)==null?void 0:O.value:n==null?void 0:n.military_distric_id;h=(A=n==null?void 0:n.ward_id)!=null&&A.ward?(z=n==null?void 0:n.ward_id)==null?void 0:z.ward:null;const L=(l==null?void 0:l.tree_level)&&+(l==null?void 0:l.tree_level)+1;switch(d){case r.Update:await Y(t==null?void 0:t.id,{...n,military_distric_id:M,parent_id:V,ward_id:h}),u({type:"success",content:"Cập nhật thành công"});break;case r.Create:await Q({...n,military_distric_id:M,parent_id:V,ward_id:h,tree_level:L}),u({type:"success",content:"Thêm mới thành công"}),f.resetFields();break;case r.View:break}_()}catch(h){console.log(h),u({type:"error",content:(h==null?void 0:h.message)||"Lỗi hệ thống"}),x.hide()}},S=()=>{if(d===r.View){_();return}else f.submit()},_=()=>{x.hide(),T.closeModal({success:!0})},N=async()=>{var e;try{((e=t==null?void 0:t.children)==null?void 0:e.length)>0?u({type:"warning",content:"Đ/c không thể xóa khi đang tồn tại mã con!"}):(await Z(t==null?void 0:t.id),u({type:"success",content:"Xóa thành công"}),x.hide(),T.closeModal({}))}catch(o){console.log(o),u({type:"error",content:(o==null?void 0:o.message)||"Lỗi hệ thống"})}};m.useEffect(()=>{w(),d===r.Create&&C(g??"")},[]);const s=m.useMemo(()=>[{title:c.CODE,content:(t==null?void 0:t.code)??null,dataIndex:"code"},{title:c.PARENT_ID,content:(t==null?void 0:t.parent)??g,dataIndex:"parent_id"},{title:c.NAME,content:(t==null?void 0:t.name)??null,require:!0,dataIndex:"name",rules:[{required:!0,message:"Thông tin không được để trống!"}]},{title:c.SHORT_NAME,content:(t==null?void 0:t.short_name)??null,dataIndex:"short_name"},{title:c.WARD_ID,content:(t==null?void 0:t.ward_id)??null,dataIndex:"ward_id"},{title:c.MILITARY_DISTRIC_ID,content:(t==null?void 0:t.military_district_id)??null,dataIndex:"military_district_id"},{title:c.ATTRIBUTE,content:(t==null?void 0:t.attribute)??null,dataIndex:"attribute"},{title:"Số thứ tự",content:(t==null?void 0:t.order_number)||null,dataIndex:"order_number"},{title:"Trạng thái",content:(t==null?void 0:t.is_enable)===void 0?!0:t==null?void 0:t.is_enable,dataIndex:"is_enable"}],[t,g]),i=e=>{if(["military_district_id"].includes(e))return $(b==null?void 0:b.militaryDistrict,"name","id")};return a.jsxDEV(q,{...B,className:"flex",size:20,children:[a.jsxDEV(H,{align:"center",justify:"space-between",className:"absolute bg-white left-0 right-0 px-6 pb-3 z-50",children:a.jsxDEV(ce,{name:"đơn vị",action:d,hanldeFinish:S,handleDelete:N},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/OrganizationsAction.tsx",lineNumber:240,columnNumber:9},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/OrganizationsAction.tsx",lineNumber:235,columnNumber:7},void 0),a.jsxDEV(R,{form:f,className:"form-container bg-secondary p-5 rounded-primary mt-10 grid grid-cols-2 gap-2",onFinish:D,disabled:d===r.View,children:d===r.Update||d===r.Create?a.jsxDEV(a.Fragment,{children:s.map((e,o)=>a.jsxDEV(F,{title:e==null?void 0:e.title,rules:e==null?void 0:e.rules,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!0,dataIndex:e.dataIndex,disable:g!==null&&(e.dataIndex==="code"||e.dataIndex==="parent_id")||d===r.Update&&e.dataIndex==="code",addressField:(e==null?void 0:e.dataIndex)==="ward_id",treeField:{isSelect:(e==null?void 0:e.dataIndex)==="parent_id",dataSelect:b.organizations},selectField:{isSelect:(e==null?void 0:e.dataIndex)==="military_district_id",dataSelect:i(e.dataIndex)},isNumberField:e.dataIndex==="order_number",isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"},o,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/OrganizationsAction.tsx",lineNumber:257,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/OrganizationsAction.tsx",lineNumber:254,columnNumber:11},void 0):a.jsxDEV(a.Fragment,{children:s.map((e,o)=>a.jsxDEV("div",{className:"flex flex-col pb-4",children:a.jsxDEV(F,{title:e==null?void 0:e.title,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!1,dataIndex:e.dataIndex,isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"},o,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/OrganizationsAction.tsx",lineNumber:294,columnNumber:19},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/OrganizationsAction.tsx",lineNumber:293,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/OrganizationsAction.tsx",lineNumber:290,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/OrganizationsAction.tsx",lineNumber:247,columnNumber:7},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/components/OrganizationsAction.tsx",lineNumber:234,columnNumber:5},void 0)},k=le,ge=[{key:r.Create,icon:a.jsxDEV(me,{},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/Organizations.tsx",lineNumber:28,columnNumber:11},void 0),className:"border-none text-primary shadow-#0",title:"Thêm mới"}];function ke(){const{openModal:d}=K(),[t,g]=m.useState([]),[f,x]=m.useState({count:0}),[T,u]=m.useState({page:1,pageSize:J}),[l,I]=m.useState({}),[b,p]=m.useState(!1),C=m.useMemo(()=>[{title:c.CODE,dataIndex:"code",fixed:"left",render:(s,i)=>a.jsxDEV("span",{className:"font-semibold text-sm cursor-pointer text-[#3D73D0]",onClick:()=>_(r.View,i),children:s??""},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/Organizations.tsx",lineNumber:56,columnNumber:15},this)},{title:c.NAME,dataIndex:"name",key:y.Name},{title:c.SHORT_NAME,dataIndex:"short_name",key:y.ShortName},{title:c.PARENT_ID,dataIndex:"parent",render:s=>s==null?void 0:s.name},{title:c.CODE_EX,dataIndex:"code_ex",width:300},{title:c.ID_EX,dataIndex:"id_ex",width:300},{title:"Địa bàn",dataIndex:"ward_id",key:"ward_id",width:300,render:s=>v(s)},{title:c.IS_ENABLE,dataIndex:"is_enable",render:s=>s?a.jsxDEV("span",{className:"text-green-600",children:"Hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/Organizations.tsx",lineNumber:102,columnNumber:15},this):a.jsxDEV("span",{className:"text-red",children:"Không hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/Organizations.tsx",lineNumber:104,columnNumber:15},this)}].map(s=>({...s,key:(s==null?void 0:s.key)||ee()})),[]),w=async s=>{try{p(!0);let i={};JSON.stringify(s)==="{}"&&(i={parent_id:{_null:!0}});const e=await Promise.all([await j({limit:-1},{...s,...i}),await ie(s)]);g(e[0]),x(e[1]),p(!1)}catch{p(!1)}},D=async s=>{if(!t.some(e=>e.parent_id===s))try{p(!0);const e=await j({limit:-1},{parent_id:s});g([...t,...e]),p(!1)}catch{p(!1)}},S=s=>{d(a.jsxDEV(k,{detail:s,action:r.View},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/Organizations.tsx",lineNumber:160,columnNumber:15},this),{width:"50vw",onModalClose(i){i!=null&&i.success?d(a.jsxDEV(k,{detail:s,action:r.Update},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/Organizations.tsx",lineNumber:165,columnNumber:13},this),{width:"50vw",onModalClose(){N()}}):N()}})},_=(s,i)=>{switch(s){case r.View:S(i);break;case r.Create:d(a.jsxDEV(k,{parent_id:i==null?void 0:i.id,action:r.Create},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/Organizations.tsx",lineNumber:187,columnNumber:11},this),{width:"50vw",onModalClose(e){e!=null&&e.success&&N()}})}},N=()=>{w(l)};return m.useEffect(()=>{w(l)},[l]),a.jsxDEV("div",{className:"w-[900px]",children:a.jsxDEV(te,{hiddenIndex:!0,total:(f==null?void 0:f.count)||0,className:"mt-5",isReloadButton:!1,setFilter:I,setPagination:u,dataSource:se(t),columns:C,actionList:ge,isAction:!0,actionWidth:100,rowClassName:"hover:bg-secondary group",loading:b,pagination:!1,x:2500,actionClick:_,filterColumns:[y.Name],btnCreate:!0,handleCreate:()=>{d(a.jsxDEV(k,{action:r.Create},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/Organizations.tsx",lineNumber:230,columnNumber:21},this),{width:"50vw",onModalClose(s){s!=null&&s.success&&N()}})},expandable:{onExpand:(s,i)=>{s&&D(i.id)},expandIcon:({expanded:s,onExpand:i,record:e})=>e!=null&&e.has_child?s?a.jsxDEV(ae,{style:{marginRight:"10px",height:"10px",width:"10px"},rev:void 0,onClick:o=>{i(e,o)}},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/Organizations.tsx",lineNumber:256,columnNumber:17},this):a.jsxDEV(ne,{style:{marginRight:"10px",height:"10px",width:"10px"},rev:void 0,onClick:o=>{i(e,o)}},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/Organizations.tsx",lineNumber:248,columnNumber:17},this):null},rowKey:"id"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/Organizations.tsx",lineNumber:210,columnNumber:7},this)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/force-categories/pages/Organizations.tsx",lineNumber:209,columnNumber:5},this)}export{ge as ACTION_TABLE,ke as default};
