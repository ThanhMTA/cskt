import{e as W,J,O as X,Q as Z,R as Y,t as D,v,w as $,r as p,x as ee,j as t,k as se,q as ne,F as te,S as oe,y as d,b4 as G,U as ie,aI as ce,H as I,z as re,E as ae,B as le,W as H}from"./index-DXrCg2vr.js";import{g as de}from"./Ward.action-D2xWCgQ3.js";import{M as me}from"./ModalCategoryActionHeader-CMTsFAdF.js";import{I as Q}from"./ItemsComponent-Ct2UsBCT.js";import{T as ue}from"./TBVTCategories.enum-rX2XZBOr.js";import{g as pe}from"./ReasonCategories.action-GFK03OFQ.js";import{a as ge}from"./arrayToTree.min-Bpdh5Rxo.js";import"./index-B0_H1u92.js";import"./index-CfEarsVi.js";import"./index-Bb5KQ1O1.js";const S="splice_closures",fe=async(o,s)=>(await W(S,{...o,fields:["*",{repair_org_id:["*"]},{tbvt_id:["*"]},{fiber_line_id:["*"]},{reason_id:["*"]},{ward_id:["*",{district_id:["*",{province_id:["*"]}]}]}],filter:s})).map(r=>{var h;return{...r,name:(h=r.tbvt_id)==null?void 0:h.name}}),be=async o=>{var m;return{count:(m=(await J(S,{aggregate:{countDistinct:"id"},query:{filter:o}}))[0].countDistinct)==null?void 0:m.id}},he=o=>X(S,{...o}),xe=(o,s)=>Z(S,o,{...s}),Ne=o=>Y(S,o),Ce="optical_fiber_lines",_e=(o,s)=>W(Ce,{...o,fields:["*",{org_id:["*"]},{org_use_id:["*"]},{org_technical_id:["*"]},{org_suport_id:["*"]},{type_id:["*"]}],filter:s}),Se=({action:o,detail:s})=>{var i,c,a,f;const[m]=D.useForm(),r=v(),h=$(),[E,x]=p.useState(!1),{openMessage:u}=ee(),[l,N]=p.useState({organizations:[],wards:[],opticalFiberLine:[],vtkt:[],reasons:[]}),j=async()=>{try{x(!0);const e=await Promise.all([ie({}),de({},{}),_e({},{}),ce({},{type:{_eq:ue.VT}}),pe({},{})]);N({organizations:ge.arrayToTree([...e[0]],{dataField:null}),wards:e[1],opticalFiberLine:e[2],vtkt:e[3],reasons:e[4]}),x(!1)}catch{x(!1)}},k=p.useMemo(()=>[{title:"Tỉnh/TP, Quận/huyện, Phường xã",content:(s==null?void 0:s.ward_id)||null,require:!1,dataIndex:"ward_id"},{title:"Địa chỉ măng xông",content:(s==null?void 0:s.address)||null,require:!1,dataIndex:"address"},{title:"Đơn vị sửa chữa",content:(s==null?void 0:s.repair_org_id)||null,require:!1,dataIndex:"repair_org_id"},{title:"Thời điểm khắc phục",content:(s==null?void 0:s.repair_at)||null,require:!1,dataIndex:"repair_at"},{title:"Vị trí măng xông",content:(s==null?void 0:s.repair_point)||null,require:!1,dataIndex:"repair_point"},{title:"Thuộc tuyến cáp",content:(s==null?void 0:s.fiber_line_id)||null,require:!1,dataIndex:"fiber_line_id"},{title:"Độ suy hao sau khi hàn nối",content:(s==null?void 0:s.attenuation_splice)||null,require:!1,dataIndex:"attenuation_splice"},{title:"Mô tả",content:(s==null?void 0:s.desc)||null,require:!1,dataIndex:"desc"},{title:"Số thứ tự",content:(s==null?void 0:s.order_number)||null,dataIndex:"order_number"},{title:"Trạng thái",content:(s==null?void 0:s.is_enable)===void 0?!0:s==null?void 0:s.is_enable,dataIndex:"is_enable"},{title:"Nguyên nhân hỏng",content:(s==null?void 0:s.reason)||null,require:!1,dataIndex:"reason"}],[s]),_=()=>{if(o===d.View){w();return}else m.submit()},w=()=>{r.hide(),h.closeModal({success:!0})},T=async()=>{var e,C,K,y,F,M,q,L,P,z;try{r.show();let b=null;const n=m.getFieldsValue(),B=(e=n==null?void 0:n.repair_org_id)!=null&&e.value?(C=n==null?void 0:n.repair_org_id)==null?void 0:C.value:n==null?void 0:n.repair_org_id,U=(K=n==null?void 0:n.fiber_line_id)!=null&&K.value?(y=n==null?void 0:n.fiber_line_id)==null?void 0:y.value:n==null?void 0:n.fiber_line_id,O=(F=n==null?void 0:n.tbvt_code)!=null&&F.value?(M=n==null?void 0:n.tbvt_code)==null?void 0:M.value:n==null?void 0:n.tbvt_code,R=(q=n==null?void 0:n.reason_id)!=null&&q.value?(L=n==null?void 0:n.reason_id)==null?void 0:L.value:n==null?void 0:n.reason_id;switch(b=(P=n==null?void 0:n.ward_id)!=null&&P.ward?(z=n==null?void 0:n.ward_id)==null?void 0:z.ward:null,o){case d.Update:await xe(s==null?void 0:s.id,{...n,repair_org_id:B,fiber_line_id:U,tbvt_id:O,ward_id:b,reason_id:R}),u({type:"success",content:"Cập nhật thành công"});break;case d.Create:await he({...n,repair_org_id:B,fiber_line_id:U,tbvt_id:O,ward_id:b,reason_id:R}),u({type:"success",content:"Thêm mới thành công"}),m.resetFields();break;case d.View:break}w()}catch(b){console.log(b),u({type:"error",content:(b==null?void 0:b.message)||"Lỗi hệ thống"}),r.hide()}},A=async()=>{try{await Ne(s==null?void 0:s.id),u({type:"success",content:"Xóa thành công"}),r.hide(),h.closeModal({})}catch(e){console.log(e),u({type:"error",content:(e==null?void 0:e.message)||"Lỗi hệ thống"})}},g=e=>{if(["tbvt_code"].includes(e))return I(l==null?void 0:l.vtkt,"code","id");if(["tbvt_name"].includes(e))return I(l==null?void 0:l.vtkt,"name","id");if(["fiber_line_id"].includes(e))return I(l==null?void 0:l.opticalFiberLine,"name","id")};return p.useEffect(()=>{j()},[]),t.jsxDEV(se,{...ne,className:"flex",size:20,children:[t.jsxDEV(te,{align:"center",justify:"space-between",className:"absolute bg-white left-0 right-0 px-6 pb-3 z-50",children:t.jsxDEV(me,{name:"măng xông",action:o,hanldeFinish:_,handleDelete:A},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:269,columnNumber:9},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:264,columnNumber:7},void 0),E?t.jsxDEV(t.Fragment,{children:t.jsxDEV(oe,{},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:271,columnNumber:22},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:271,columnNumber:20},void 0):t.jsxDEV(D,{form:m,className:"form-container bg-secondary p-5 rounded-primary mt-10 grid grid-cols-2 gap-2",onFinish:T,requiredMark:!1,initialValues:{tbvt_name:((i=s==null?void 0:s.tbvt_id)==null?void 0:i.id)||null,tbvt_code:((c=s==null?void 0:s.tbvt_id)==null?void 0:c.id)||null},children:o===d.Update||o===d.Create?t.jsxDEV(t.Fragment,{children:[t.jsxDEV(D.Item,{name:"tbvt_name",label:t.jsxDEV("span",{className:"font-extrabold",children:["Tên TBVT",t.jsxDEV("span",{className:"text-red",children:"*"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:288,columnNumber:20},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:286,columnNumber:17},void 0),labelCol:{span:24},rules:[{required:!0}],children:t.jsxDEV(G,{optionFilterProp:"label",onChange:e=>{m.setFieldValue("tbvt_code",e)},showSearch:!0,allowClear:!0,options:g("tbvt_name")},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:296,columnNumber:15},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:283,columnNumber:13},void 0),t.jsxDEV(D.Item,{label:t.jsxDEV("span",{className:"font-extrabold",children:["Mã TBVT",t.jsxDEV("span",{className:"text-red",children:"*"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:310,columnNumber:20},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:308,columnNumber:17},void 0),name:"tbvt_code",labelCol:{span:24},rules:[{required:!0}],children:t.jsxDEV(G,{optionFilterProp:"label",onChange:e=>{m.setFieldValue("tbvt_name",e)},showSearch:!0,allowClear:!0,options:g("tbvt_code")},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:319,columnNumber:15},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:306,columnNumber:13},void 0),k.map((e,C)=>t.jsxDEV(Q,{title:e==null?void 0:e.title,rules:e==null?void 0:e.rules,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!0,dataIndex:e.dataIndex,isDateField:(e==null?void 0:e.dataIndex)==="repair_at",treeField:{isSelect:(e==null?void 0:e.dataIndex)==="repair_org_id",dataSelect:l.organizations},selectField:{isSelect:(e==null?void 0:e.dataIndex)==="fiber_line_id",dataSelect:g(e==null?void 0:e.dataIndex)},addressField:(e==null?void 0:e.dataIndex)==="ward_id",isNumberField:(e==null?void 0:e.dataIndex)==="order_number",isRadioField:(e==null?void 0:e.dataIndex)==="is_enable",isTextArea:(e==null?void 0:e.dataIndex)==="reason"},C,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:331,columnNumber:17},void 0))]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:282,columnNumber:11},void 0):t.jsxDEV(t.Fragment,{children:[t.jsxDEV("div",{className:"flex flex-col gap-[10px]",children:[t.jsxDEV("p",{className:"font-bold text-sm",children:["Tên TBVT",t.jsxDEV("span",{className:"text-red",children:"*"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:369,columnNumber:18},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:367,columnNumber:15},void 0),t.jsxDEV(t.Fragment,{children:t.jsxDEV("p",{className:"text-sm font-normal",children:(a=s==null?void 0:s.tbvt_id)==null?void 0:a.name},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:372,columnNumber:17},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:371,columnNumber:15},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:366,columnNumber:13},void 0),t.jsxDEV("div",{className:"flex flex-col gap-[10px]",children:[t.jsxDEV("p",{className:"font-bold text-sm",children:["Mã TBVT",t.jsxDEV("span",{className:"text-red",children:"*"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:381,columnNumber:18},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:379,columnNumber:15},void 0),t.jsxDEV(t.Fragment,{children:t.jsxDEV("p",{className:"text-sm font-normal",children:(f=s==null?void 0:s.tbvt_id)==null?void 0:f.code},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:384,columnNumber:17},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:383,columnNumber:15},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:378,columnNumber:13},void 0),k.map((e,C)=>t.jsxDEV("div",{className:"flex flex-col pb-4",children:t.jsxDEV(Q,{title:e==null?void 0:e.title,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!1,dataIndex:e.dataIndex,isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"},C,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:393,columnNumber:19},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:392,columnNumber:17},void 0))]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:365,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:271,columnNumber:40},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/components/SpliceClosuresAction.tsx",lineNumber:259,columnNumber:5},void 0)},V=Se;function ye(){const{openModal:o}=$(),[s,m]=p.useState([]),[r,h]=p.useState({count:0}),[E,x]=p.useState(!1),[u,l]=p.useState({page:1,pageSize:re}),[N,j]=p.useState({}),k=[{fixed:"left",width:"200px",title:"Địa chỉ măng xông",key:"address",dataIndex:"address",render:(i,c)=>t.jsxDEV("span",{className:"font-semibold text-sm cursor-pointer text-[#3D73D0]",onClick:()=>T(d.View,c),children:i??""},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/SpliceClosures.tsx",lineNumber:75,columnNumber:11},this)},{title:"Nguyên nhân hỏng",dataIndex:"reason",key:H()},{title:"Đơn vị thực hiện",dataIndex:"repair_org_code_old",key:H()},{title:"Mô tả",dataIndex:"desc"}],_=async(i,c,a)=>{try{let f={};a!=null&&a.address&&(f={address:a==null?void 0:a.address}),a==null||delete a.address,Object.keys(a).length>0&&(f={tbvt_id:{...a}}),x(!0);const e=await Promise.all([await fe({limit:c,page:i},f),await be(f)]);m(e[0]),h(e[1]),x(!1)}catch{x(!1)}},w=i=>{o(t.jsxDEV(V,{detail:i,action:d.View},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/SpliceClosures.tsx",lineNumber:162,columnNumber:15},this),{width:"45vw",onModalClose(c){c!=null&&c.success?o(t.jsxDEV(V,{detail:i,action:d.Update},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/SpliceClosures.tsx",lineNumber:167,columnNumber:13},this),{width:"45vw",onModalClose(){g()}}):g()}})},T=(i,c)=>{switch(i){case d.View:w(c);break;case d.Create:A(c);break}},A=i=>{o(t.jsxDEV(V,{detail:i,action:d.Create},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/SpliceClosures.tsx",lineNumber:192,columnNumber:15},this),{width:"45vw",onModalClose(c){c!=null&&c.success&&g()}})},g=()=>{_(u.page,u.pageSize,N)};return p.useEffect(()=>{_(u.page,u.pageSize,N)},[N]),t.jsxDEV("div",{className:"w-[900px]",children:t.jsxDEV(ae,{total:(r==null?void 0:r.count)||0,className:"mt-5",isReloadButton:!0,dataSource:[...s],columns:k,isAction:!0,loading:E,setFilter:j,setPagination:l,x:2e3,paginationCustom:{current:u.page,pageSize:u.pageSize,total:r==null?void 0:r.count},onChange:({current:i,pageSize:c})=>{l({page:i,pageSize:c}),_(i,c,N)},filterColumns:[le.Name,"address"],actionClick:T,btnCreate:!0,handleCreate:()=>{o(t.jsxDEV(V,{action:d.Create},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/SpliceClosures.tsx",lineNumber:237,columnNumber:21},this),{width:"45vw",onModalClose(i){i!=null&&i.success&&g()}})}},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/SpliceClosures.tsx",lineNumber:213,columnNumber:7},this)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/technical-categories/pages/SpliceClosures.tsx",lineNumber:212,columnNumber:5},this)}export{ye as default};
