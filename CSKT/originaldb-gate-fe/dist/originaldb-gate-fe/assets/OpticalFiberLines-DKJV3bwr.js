import{t as K,v as Y,w as z,x as Z,r as m,j as i,k as v,q as ee,F as te,y as o,U as ne,H as se,cz as ie,aO as oe,B as q,W as re,E as ae,aQ as ce}from"./index-DXrCg2vr.js";import{a as de}from"./FiberLineType.action--k-1Z-uG.js";import{g as M,a as P,c as me,u as pe,r as ge,b as le,m as be}from"./OpticalFiberLines.action-Da9FPpJg.js";import{M as ue}from"./ModalCategoryActionHeader-CMTsFAdF.js";import{I as U}from"./ItemsComponent-Ct2UsBCT.js";import{a as T}from"./arrayToTree.min-Bpdh5Rxo.js";import{P as fe}from"./PlusCircleOutlined-JzIS5LvP.js";import"./index-B0_H1u92.js";import"./index-CfEarsVi.js";import"./index-Bb5KQ1O1.js";const _e=({action:a,detail:t,parent_id:b})=>{const[d]=K.useForm(),h=Y(),I=z(),{openMessage:p}=Z(),[g,f]=m.useState(null),[N,_]=m.useState(null),[u,w]=m.useState({organizations:[],fiberLineType:[],opticalFiberLines:[]}),x=async()=>{if(a===o.View&&(t!=null&&t.parent_id)){const l=await Promise.all([M(t==null?void 0:t.parent_id,{})]);_(l[0]);return}const e=await Promise.all([P({}),b?M(b,{}):Promise.resolve([])]);f(T.arrayToTree([...e[0]],{dataField:null})),_(e[1]),o.Create&&d.setFieldsValue({parent_id:b})},s=m.useMemo(()=>[{title:"Tên",content:(t==null?void 0:t.name)||null,require:!0,dataIndex:"name",rules:[{required:!0,message:"Thông tin không được để trống!"}]},{title:"Loại tuyến cáp",content:(t==null?void 0:t.type_id)||null,dataIndex:"type_id",rules:[{required:!0,message:"Loại tuyến cáp không được để trống!"}]},{title:"Ký hiệu",content:(t==null?void 0:t.symbol)||null,dataIndex:"symbol"},{title:"Tuyến cáp quang trực thuộc",content:N,dataIndex:"parent_id"},{title:"Đơn vị quản lý",content:(t==null?void 0:t.org_manage_id)||null,dataIndex:"org_manage_id"},{title:"Đơn vị khai thác",content:(t==null?void 0:t.org_use_id)||null,dataIndex:"org_use_id"},{title:"Đơn vị bảo đảm kỹ thuật",content:(t==null?void 0:t.org_suport_id)||null,dataIndex:"org_suport_id"},{title:"Độ dài tuyến cáp",content:(t==null?void 0:t.length)||null,dataIndex:"length"},{title:"Độ dài quản lý",content:(t==null?void 0:t.manage_length)||null,dataIndex:"manage_length"},{title:"Tọa độ",content:(t==null?void 0:t.coordinates)||null,dataIndex:"coordinates"},{title:"Điểm đầu",content:(t==null?void 0:t.first_point)||null,dataIndex:"first_point"},{title:"Điểm cuối",content:(t==null?void 0:t.final_point)||null,dataIndex:"final_point"},{title:"Tổng số sợi",content:(t==null?void 0:t.number_of_fiber)||null,dataIndex:"number_of_fiber"},{title:"Mô tả",content:(t==null?void 0:t.desc)||null,dataIndex:"desc"},{title:"Số thứ tự",content:(t==null?void 0:t.order_number)||null,dataIndex:"order_number"},{title:"Trạng thái",content:(t==null?void 0:t.is_enable)===void 0?!0:t==null?void 0:t.is_enable,dataIndex:"is_enable"}],[t,b,N]),r=async()=>{const e=await Promise.all([await ne({}),await de({},{}),await P({type_id:{name:{_icontains:"quang"}}})]);w({opticalFiberLines:T.arrayToTree([...e[2]],{dataField:null}),organizations:T.arrayToTree([...e[0]],{dataField:null}),fiberLineType:e[1]})},c=()=>{if(a===o.View){F();return}else d.submit()},F=()=>{h.hide(),I.closeModal({success:!0})},R=async()=>{var e,l,k,L,C,S,D,O,V,E,A,j;try{h.show();const n=d.getFieldsValue();switch(a){case o.Update:const H=(e=n==null?void 0:n.org_manage_id)!=null&&e.value?(l=n==null?void 0:n.org_manage_id)==null?void 0:l.value:n==null?void 0:n.org_manage_id,W=(k=n==null?void 0:n.org_use_id)!=null&&k.value?(L=n==null?void 0:n.org_use_id)==null?void 0:L.value:n==null?void 0:n.org_use_id,Q=(C=n==null?void 0:n.org_technical_id)!=null&&C.value?(S=n==null?void 0:n.org_technical_id)==null?void 0:S.value:n==null?void 0:n.org_technical_id,X=(D=n==null?void 0:n.org_support_id)!=null&&D.value?(O=n==null?void 0:n.org_support_id)==null?void 0:O.value:n==null?void 0:n.org_support_id,$=(V=n==null?void 0:n.type_id)!=null&&V.value?(E=n==null?void 0:n.type_id)==null?void 0:E.value:n==null?void 0:n.type_id,J=(A=n==null?void 0:n.parent_id)!=null&&A.value?(j=n==null?void 0:n.parent_id)==null?void 0:j.value:n==null?void 0:n.parent_id;await pe(t==null?void 0:t.id,{...n,org_manage_id:H,org_use_id:W,org_technical_id:Q,org_support_id:X,type_id:$,parent_id:J}),p({type:"success",content:"Cập nhật thành công"});break;case o.Create:await me({...n}),p({type:"success",content:"Thêm mới thành công"}),d.resetFields();break;case o.View:break}F()}catch(n){console.log(n),p({type:"error",content:(n==null?void 0:n.message)||"Lỗi hệ thống"}),h.hide()}},B=async()=>{try{await ge(t==null?void 0:t.id),p({type:"success",content:"Xóa thành công"}),F()}catch(e){console.log(e),p({type:"error",content:(e==null?void 0:e.message)||"Lỗi hệ thống"})}},G=e=>{if(["type_id"].includes(e))return se(u==null?void 0:u.fiberLineType,"name","id")};return m.useEffect(()=>{r(),x()},[]),i.jsxDEV(v,{...ee,className:"flex",size:20,children:[i.jsxDEV(te,{align:"center",justify:"space-between",className:"absolute bg-white left-0 right-0 px-6 pb-3 z-50",children:i.jsxDEV(ue,{name:"danh sách tuyến cáp",action:a,hanldeFinish:c,handleDelete:B},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/OpticalFiberLinesAction.tsx",lineNumber:294,columnNumber:9},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/OpticalFiberLinesAction.tsx",lineNumber:289,columnNumber:7},void 0),i.jsxDEV(K,{form:d,className:"form-container bg-secondary p-5 rounded-primary mt-10 grid grid-cols-2 gap-2",onFinish:R,disabled:a===o.View,children:a===o.Update||a===o.Create?i.jsxDEV(i.Fragment,{children:s.map((e,l)=>i.jsxDEV(U,{title:e==null?void 0:e.title,rules:e==null?void 0:e.rules,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!0,dataIndex:e.dataIndex,disable:!!(a===o.Create&&b&&e.dataIndex==="parent_id"||a!==o.Create&&e.dataIndex==="parent_id"),isNumberField:e.dataIndex==="order_number"||e.dataIndex==="length"||e.dataIndex==="manage_length"||e.dataIndex==="number_of_fiber",selectField:{isSelect:e.dataIndex==="type_id",dataSelect:e.dataIndex==="type_id"?G(e.dataIndex):u.opticalFiberLines},treeField:{isSelect:(e==null?void 0:e.dataIndex)==="org_manage_id"||(e==null?void 0:e.dataIndex)==="org_use_id"||(e==null?void 0:e.dataIndex)==="org_technical_id"||(e==null?void 0:e.dataIndex)==="org_suport_id"||(e==null?void 0:e.dataIndex)==="parent_id",dataSelect:(e==null?void 0:e.dataIndex)==="parent_id"?g:u.organizations},isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"},l,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/OpticalFiberLinesAction.tsx",lineNumber:311,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/OpticalFiberLinesAction.tsx",lineNumber:308,columnNumber:11},void 0):i.jsxDEV(i.Fragment,{children:s.map((e,l)=>i.jsxDEV("div",{className:"flex flex-col pb-4",children:i.jsxDEV(U,{title:e==null?void 0:e.title,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!1,dataIndex:e==null?void 0:e.dataIndex,isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"},l,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/OpticalFiberLinesAction.tsx",lineNumber:363,columnNumber:19},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/OpticalFiberLinesAction.tsx",lineNumber:362,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/OpticalFiberLinesAction.tsx",lineNumber:359,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/OpticalFiberLinesAction.tsx",lineNumber:301,columnNumber:7},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/OpticalFiberLinesAction.tsx",lineNumber:288,columnNumber:5},void 0)},y=_e,he=[{key:o.Create,icon:i.jsxDEV(fe,{},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/OpticalFiberLines.tsx",lineNumber:29,columnNumber:11},void 0),className:"border-none text-primary shadow-#0",title:"Thêm mới"}];function Se(){const{openModal:a}=z(),[t,b]=m.useState([]),[d,h]=m.useState({count:0}),[I,p]=m.useState(!1),g=m.useRef({...ie}),f=oe(),N=[{title:"Tên tuyến cáp",dataIndex:"name",width:200,fixed:"left",key:q.Name,render:(s,r)=>i.jsxDEV("span",{className:"font-semibold text-sm cursor-pointer text-[#3D73D0]",onClick:()=>w(o.View,r),children:s??""},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/OpticalFiberLines.tsx",lineNumber:55,columnNumber:11},this)},{title:"Phân loại tuyến cáp",dataIndex:"type_id",width:150,render:s=>(s==null?void 0:s.name)??""},{title:"Đơn vị quản lý tuyến cáp",dataIndex:"org_manage_id",width:300,render:s=>(s==null?void 0:s.name)??""},{title:"Độ dài tuyến cáp",dataIndex:"length",width:150},{title:"Độ dài quản lý",dataIndex:"manage_length",width:150},{title:"Vị trí điểm đầu",dataIndex:"first_point",width:150},{title:"Vị trí điểm cuối",dataIndex:"final_point",width:150},{title:"Tổng số sợi",dataIndex:"number_of_fiber",width:150},{title:"Ghi chú",dataIndex:"note",width:150},{title:"Trạng thái",dataIndex:"is_enable",width:150,render:s=>s?i.jsxDEV("span",{className:"text-green-600",children:"Hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/OpticalFiberLines.tsx",lineNumber:113,columnNumber:11},this):i.jsxDEV("span",{className:"text-red",children:"Không hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/OpticalFiberLines.tsx",lineNumber:115,columnNumber:11},this)}].map(s=>({...s,key:(s==null?void 0:s.key)||re()})),_=async(s,r)=>{try{p(!0);const c=await Promise.all([await le({limit:r,page:s},{type_id:{name:{_icontains:f.pathname.split("/")[f.pathname.split("/").length-1].includes("quang")?"quang":"đồng"}}}),await be({type_id:{name:{_icontains:f.pathname.split("/")[f.pathname.split("/").length-1].includes("quang")?"quang":"đồng"}}})]);b(c[0]),h(c[1]),p(!1)}catch{p(!1)}},u=s=>{a(i.jsxDEV(y,{detail:s,action:o.View},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/OpticalFiberLines.tsx",lineNumber:164,columnNumber:15},this),{width:"40vw",onModalClose(r){r!=null&&r.success&&a(i.jsxDEV(y,{detail:s,action:o.Update},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/OpticalFiberLines.tsx",lineNumber:169,columnNumber:13},this),{width:"40vw",onModalClose(c){c!=null&&c.success&&x()}})}})},w=(s,r)=>{switch(console.log(s),s){case o.View:u(r);break;case o.Create:a(i.jsxDEV(y,{parent_id:r==null?void 0:r.id,action:o.Create},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/OpticalFiberLines.tsx",lineNumber:191,columnNumber:11},this),{width:"50vw",onModalClose(c){c!=null&&c.success&&x()}})}},x=()=>{_(g.current.current,g.current.pageSize)};return m.useEffect(()=>{_(g.current.current,g.current.pageSize)},[]),i.jsxDEV("div",{className:"w-[900px]",children:i.jsxDEV(ae,{total:(d==null?void 0:d.count)||0,className:"mt-5",isReloadButton:!1,dataSource:ce(t),columns:N,actionList:he,isAction:!0,loading:I,actionWidth:100,rowClassName:"hover:bg-secondary group",paginationCustom:{...g.current,total:d==null?void 0:d.count},onChange:({current:s,pageSize:r})=>{g.current={current:s,pageSize:r},_(s,r)},actionClick:w,filterColumns:[q.Name],btnCreate:!0,handleCreate:()=>{a(i.jsxDEV(y,{action:o.Create},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/OpticalFiberLines.tsx",lineNumber:241,columnNumber:21},this),{width:"40vw",onModalClose(s){s!=null&&s.success&&x()}})}},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/OpticalFiberLines.tsx",lineNumber:217,columnNumber:7},this)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/OpticalFiberLines.tsx",lineNumber:216,columnNumber:5},this)}export{he as ACTION_TABLE,Se as default};
