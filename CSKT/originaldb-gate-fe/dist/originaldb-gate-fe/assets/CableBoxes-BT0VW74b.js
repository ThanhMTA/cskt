import{e as F,J as j,O as K,Q as L,R as M,t as B,v as q,w as I,x as P,r as m,j as a,k as U,q as z,F as O,y as r,H as R,z as G,B as V,V as H,W,E as J,G as Q}from"./index-DXrCg2vr.js";import{g as X}from"./Ward.action-D2xWCgQ3.js";import{b as Z}from"./OpticalFiberLines.action-Da9FPpJg.js";import{M as $}from"./ModalCategoryActionHeader-CMTsFAdF.js";import{I as y}from"./ItemsComponent-Ct2UsBCT.js";import"./index-B0_H1u92.js";import"./index-CfEarsVi.js";import"./index-Bb5KQ1O1.js";const C="cable_boxes",Y=(o,t)=>F(C,{...o,fields:["*",{ward_id:["*",{district_id:["*",{province_id:["*"]}]}]}],filter:t}),v=async o=>{var d;return{count:(d=(await j(C,{aggregate:{countDistinct:"id"},query:{filter:o}}))[0].countDistinct)==null?void 0:d.id}},ee=o=>K(C,{...o}),te=(o,t)=>L(C,o,{...t}),se=o=>M(C,o),ne=({action:o,detail:t})=>{const[d]=B.useForm(),c=q(),_=I(),{openMessage:b}=P(),[f,p]=m.useState({wards:[],opticalFiberLines:[]}),h=m.useMemo(()=>[{title:"Tên hộp, tủ cáp",content:(t==null?void 0:t.name)||null,require:!0,dataIndex:"name",rules:[{required:!0,message:"Thông tin không được để trống!"}]},{title:"Vị trí lắp đặt",content:(t==null?void 0:t.address)||null,dataIndex:"address"},{title:"Địa bàn",content:(t==null?void 0:t.ward_id)||null,dataIndex:"ward_id"},{title:"Thuộc tuyến cáp",content:(t==null?void 0:t.fiber_line_id)||null,dataIndex:"fiber_line_id"},{title:"Mô tả chi tiết bổ sung",content:(t==null?void 0:t.desc)||null,dataIndex:"desc"},{title:"Trạng thái",content:(t==null?void 0:t.is_enable)===void 0?!0:t==null?void 0:t.is_enable,dataIndex:"is_enable"}],[t]),u=async()=>{try{const e=await Promise.all([await X({},{}),await Z({},{})]);p({wards:e[0],opticalFiberLines:e[1]})}catch{}},S=()=>{if(o===r.View){w();return}else d.submit()},w=()=>{c.hide(),_.closeModal({success:!0})},N=async()=>{var e,s,i,g,x,E;try{c.show();let l=null;const n=d.getFieldsValue();switch(o){case r.Update:const A=(e=n==null?void 0:n.fiber_line_id)!=null&&e.value?(s=n==null?void 0:n.fiber_line_id)==null?void 0:s.value:n==null?void 0:n.fiber_line_id;l=(i=n==null?void 0:n.ward_id)!=null&&i.ward?(g=n==null?void 0:n.ward_id)==null?void 0:g.ward:null,await te(t==null?void 0:t.id,{...n,fiber_line_id:A,ward_id:l}),b({type:"success",content:"Cập nhật thành công"});break;case r.Create:l=(x=n==null?void 0:n.ward_id)!=null&&x.ward?(E=n==null?void 0:n.ward_id)==null?void 0:E.ward:null,await ee({...n,ward_id:l}),b({type:"success",content:"Thêm mới thành công"}),d.resetFields();break;case r.View:break}w()}catch(l){console.log(l),b({type:"error",content:(l==null?void 0:l.message)||"Lỗi hệ thống"}),c.hide()}},D=e=>{if(["fiber_line_id"].includes(e))return R(f==null?void 0:f.opticalFiberLines,"name","id")},k=async()=>{try{await se(t==null?void 0:t.id),b({type:"success",content:"Xóa thành công"}),w()}catch(e){console.log(e),b({type:"error",content:(e==null?void 0:e.message)||"Lỗi hệ thống"})}};return m.useEffect(()=>{u()},[]),a.jsxDEV(U,{...z,className:"flex",size:20,children:[a.jsxDEV(O,{align:"center",justify:"space-between",className:"absolute bg-white left-0 right-0 px-6 pb-3 z-50",children:a.jsxDEV($,{name:"hộp cáp, tủ cáp",action:o,hanldeFinish:S,handleDelete:k},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/CableBoxesAction.tsx",lineNumber:181,columnNumber:9},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/CableBoxesAction.tsx",lineNumber:176,columnNumber:7},void 0),a.jsxDEV(B,{form:d,className:"form-container bg-secondary p-5 rounded-primary mt-10 grid grid-cols-2 gap-2",onFinish:N,disabled:o===r.View,children:o===r.Update||o===r.Create?a.jsxDEV(a.Fragment,{children:h.map((e,s)=>a.jsxDEV(y,{title:e==null?void 0:e.title,rules:e==null?void 0:e.rules,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!0,dataIndex:e.dataIndex,selectField:{isSelect:(e==null?void 0:e.dataIndex)==="fiber_line_id",dataSelect:D(e==null?void 0:e.dataIndex)},addressField:(e==null?void 0:e.dataIndex)==="ward_id",isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"},s,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/CableBoxesAction.tsx",lineNumber:275,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/CableBoxesAction.tsx",lineNumber:272,columnNumber:11},void 0):a.jsxDEV(a.Fragment,{children:h.map((e,s)=>a.jsxDEV("div",{className:"flex flex-col pb-4",children:a.jsxDEV(y,{title:e==null?void 0:e.title,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!1,dataIndex:e.dataIndex,isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"},s,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/CableBoxesAction.tsx",lineNumber:301,columnNumber:19},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/CableBoxesAction.tsx",lineNumber:300,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/CableBoxesAction.tsx",lineNumber:297,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/CableBoxesAction.tsx",lineNumber:183,columnNumber:7},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/CableBoxesAction.tsx",lineNumber:171,columnNumber:5},void 0)},T=ne,oe=[{key:r.View,icon:a.jsxDEV(Q,{},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/CableBoxes.tsx",lineNumber:29,columnNumber:11},void 0),tooltip:"Chi tiết"}];function ge(){const{openModal:o}=I(),[t,d]=m.useState([]),[c,_]=m.useState({count:0}),[b,f]=m.useState(!1),[p,h]=m.useState({page:1,pageSize:G}),[u,S]=m.useState({}),w=[{title:"Tên hộp, tủ cáp",dataIndex:"name",width:200,fixed:"left",key:V.Name,render:(s,i)=>a.jsxDEV("span",{className:"font-semibold text-sm cursor-pointer text-[#3D73D0]",onClick:()=>k(r.View,i),children:s??""},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/CableBoxes.tsx",lineNumber:56,columnNumber:11},this)},{title:"Vị trí lắp đặt",dataIndex:"address",width:300},{title:"Địa bàn",dataIndex:"ward_id",key:"ward_id",width:330,render:s=>H(s)},{title:"Thuộc tuyến cáp",dataIndex:"fiber_line_id",width:330,render:s=>(s==null?void 0:s.name)??""},{title:"Trạng thái",dataIndex:"is_enable",width:150,render:s=>s?a.jsxDEV("span",{className:"text-green-600",children:"Hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/CableBoxes.tsx",lineNumber:89,columnNumber:11},this):a.jsxDEV("span",{className:"text-red",children:"Không hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/CableBoxes.tsx",lineNumber:91,columnNumber:11},this)}].map(s=>({...s,key:(s==null?void 0:s.key)||W()})),N=async(s,i,g)=>{try{f(!0);const x=await Promise.all([await Y({limit:i,page:s},g),await v({})]);d(x[0]),_(x[1]),f(!1)}catch{f(!1)}},D=s=>{o(a.jsxDEV(T,{detail:s,action:r.View},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/CableBoxes.tsx",lineNumber:116,columnNumber:15},this),{width:"40vw",onModalClose(i){i!=null&&i.success&&o(a.jsxDEV(T,{detail:s,action:r.Update},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/CableBoxes.tsx",lineNumber:120,columnNumber:21},this),{width:"40vw",onModalClose(g){g!=null&&g.success&&e()}})}})},k=(s,i)=>{s===r.View&&D(i)},e=()=>{N(p.page,p.pageSize,u)};return m.useEffect(()=>{N(p.page,p.pageSize,u)},[u]),a.jsxDEV("div",{className:"w-[900px]",children:a.jsxDEV(J,{total:(c==null?void 0:c.count)||0,className:"mt-5",isReloadButton:!1,dataSource:t,columns:w,actionList:oe,isAction:!1,loading:b,setPagination:h,setFilter:S,paginationCustom:{current:p.page,pageSize:p.pageSize,total:c==null?void 0:c.count},onChange:({current:s,pageSize:i})=>{h({page:s,pageSize:i}),N(s,i,u)},actionClick:k,filterColumns:[V.Name],btnCreate:!0,handleCreate:()=>{o(a.jsxDEV(T,{action:r.Create},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/CableBoxes.tsx",lineNumber:174,columnNumber:21},this),{width:"40vw",onModalClose(s){s!=null&&s.success&&e()}})}},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/CableBoxes.tsx",lineNumber:148,columnNumber:7},this)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/CableBoxes.tsx",lineNumber:147,columnNumber:5},this)}export{oe as ACTION_TABLE,ge as default};
