import{e as E,J as j,O as A,Q as F,R as K,t as _,v as q,w as D,x as z,r as l,j as i,k as L,q as U,F as B,y as r,U as P,H as O,z as R,B as C,b8 as G,bt as H,W as X,E as J,G as Q}from"./index-DXrCg2vr.js";import{g as W}from"./Country.action-CW-uQgoU.js";import{M as Z}from"./ModalCategoryActionHeader-CMTsFAdF.js";import{I as T}from"./ItemsComponent-Ct2UsBCT.js";import{a as $}from"./arrayToTree.min-Bpdh5Rxo.js";import"./index-B0_H1u92.js";import"./index-CfEarsVi.js";import"./index-Bb5KQ1O1.js";const x="mobile_vehicles",Y=(o,t)=>E(x,{...o,fields:["*",{org_id:["*"]},{origin_id:["*"]}],filter:t}),v=async o=>{var d;return{count:(d=(await j(x,{aggregate:{countDistinct:"id"},query:{filter:o}}))[0].countDistinct)==null?void 0:d.id}},ee=o=>A(x,{...o}),te=(o,t)=>F(x,o,{...t}),se=o=>K(x,o),ne=({action:o,detail:t})=>{const[d]=_.useForm(),c=q(),w=D(),{openMessage:p}=z(),[m,g]=l.useState({organizations:[],country:[]}),h=l.useMemo(()=>[{title:"Tên xe cơ động",content:(t==null?void 0:t.name)||null,require:!0,dataIndex:"name",rules:[{required:!0,message:"Thông tin không được để trống!"}]},{title:"Mã TBVT",content:(t==null?void 0:t.code)||null,dataIndex:"code"},{title:"Biển số xe",content:(t==null?void 0:t.serial_number)||null,dataIndex:"serial_number"},{title:"Đơn vị quản lý",content:(t==null?void 0:t.org_id)||null,dataIndex:"org_id"},{title:"Xuất xứ",content:(t==null?void 0:t.origin_id)||null,dataIndex:"origin_id"},{title:"Cấp chất lượng",content:(t==null?void 0:t.quality)||null,dataIndex:"quality"},{title:"Mã định danh",content:(t==null?void 0:t.eid)||null,dataIndex:"eid"},{title:"Ngày đưa vào sử dụng",content:(t==null?void 0:t.used_at)||null,dataIndex:"used_at"},{title:"Số thứ tự",content:(t==null?void 0:t.order_number)||null,dataIndex:"order_number"},{title:"Trạng thái",content:(t==null?void 0:t.is_enable)===void 0?!0:t==null?void 0:t.is_enable,dataIndex:"is_enable"}],[t]),f=async()=>{const e=await Promise.all([await P({}),await W({},{})]);g({organizations:$.arrayToTree([...e[0]],{dataField:null}),country:e[1]})},V=async()=>{var e,s,a,u;try{c.show();const n=d.getFieldsValue();switch(o){case r.Update:const I=(e=n==null?void 0:n.org_id)!=null&&e.value?(s=n==null?void 0:n.org_id)==null?void 0:s.value:n==null?void 0:n.org_id,y=(a=n==null?void 0:n.origin_id)!=null&&a.value?(u=n==null?void 0:n.origin_id)==null?void 0:u.value:n==null?void 0:n.origin_id;await te(t==null?void 0:t.id,{...n,org_id:I,origin_id:y}),p({type:"success",content:"Cập nhật thành công"});break;case r.Create:await ee(n),p({type:"success",content:"Thêm mới thành công"}),d.resetFields();break;case r.View:break}b()}catch(n){console.log(n),p({type:"error",content:(n==null?void 0:n.message)||"Lỗi hệ thống"}),c.hide()}},k=()=>{if(o===r.View){b();return}else d.submit()},b=()=>{c.hide(),w.closeModal({success:!0})},N=async()=>{try{await se(t==null?void 0:t.id),p({type:"success",content:"Xóa thành công"}),b()}catch(e){console.log(e),p({type:"error",content:(e==null?void 0:e.message)||"Lỗi hệ thống"})}},M=e=>{if(["origin_id"].includes(e))return O(m==null?void 0:m.country,"name","id")};return l.useEffect(()=>{f()},[]),i.jsxDEV(L,{...U,className:"flex",size:20,children:[i.jsxDEV(B,{align:"center",justify:"space-between",className:"absolute bg-white left-0 right-0 px-6 pb-3 z-50",children:i.jsxDEV(Z,{name:"xe cơ động",action:o,hanldeFinish:k,handleDelete:N},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/MobileVehiclesAction.tsx",lineNumber:199,columnNumber:9},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/MobileVehiclesAction.tsx",lineNumber:194,columnNumber:7},void 0),i.jsxDEV(_,{form:d,className:"form-container bg-secondary p-5 rounded-primary mt-10 grid grid-cols-2 gap-2",onFinish:V,disabled:o===r.View,children:o===r.Update||o===r.Create?i.jsxDEV(i.Fragment,{children:h.map((e,s)=>i.jsxDEV(T,{title:e==null?void 0:e.title,rules:e==null?void 0:e.rules,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!0,dataIndex:e.dataIndex,isNumberField:e.dataIndex==="order_number"||e.dataIndex==="quality",isDateField:e.dataIndex==="used_at",treeField:{isSelect:(e==null?void 0:e.dataIndex)==="org_id",dataSelect:m.organizations},selectField:{isSelect:e.dataIndex==="origin_id",dataSelect:M(e.dataIndex)},isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"},s,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/MobileVehiclesAction.tsx",lineNumber:211,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/MobileVehiclesAction.tsx",lineNumber:208,columnNumber:11},void 0):i.jsxDEV(i.Fragment,{children:h.map((e,s)=>i.jsxDEV("div",{className:"flex flex-col pb-4",children:i.jsxDEV(T,{title:e==null?void 0:e.title,content:e==null?void 0:e.content,require:e==null?void 0:e.require,statusUpdate:!1,dataIndex:e.dataIndex,isRadioField:(e==null?void 0:e.dataIndex)==="is_enable"},s,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/MobileVehiclesAction.tsx",lineNumber:248,columnNumber:19},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/MobileVehiclesAction.tsx",lineNumber:247,columnNumber:17},void 0))},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/MobileVehiclesAction.tsx",lineNumber:244,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/MobileVehiclesAction.tsx",lineNumber:201,columnNumber:7},void 0)]},void 0,!0,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/components/MobileVehiclesAction.tsx",lineNumber:189,columnNumber:5},void 0)},S=ne,oe=[{key:r.View,icon:i.jsxDEV(Q,{},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/MobileVehicles.tsx",lineNumber:29,columnNumber:11},void 0),tooltip:"Chi tiết"}];function ue(){const{openModal:o}=D(),[t,d]=l.useState([]),[c,w]=l.useState({count:0}),[p,m]=l.useState(!1),[g,h]=l.useState({page:1,pageSize:R}),[f,V]=l.useState({}),k=[{title:"Tên xe cơ động",dataIndex:"name",fixed:"left",width:200,key:C.Name,render:(s,a)=>i.jsxDEV("span",{className:"font-semibold text-sm cursor-pointer text-[#3D73D0]",onClick:()=>N(r.View,a),children:s??""},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/MobileVehicles.tsx",lineNumber:58,columnNumber:11},this)},{title:"Mã TBVT",dataIndex:"code",width:200,render:s=>s||"---"},{title:"Biển số xe",dataIndex:"serial_number",width:200},{title:"Đơn vị quản lý",dataIndex:"org_id",width:330,render:s=>(s==null?void 0:s.name)??""},{title:"Xuất xứ",dataIndex:"origin_id",width:330,render:s=>(s==null?void 0:s.name)??""},{title:"Trạng thái",dataIndex:"is_enable",width:150,render:s=>s?i.jsxDEV("span",{className:"text-green-600",children:"Hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/MobileVehicles.tsx",lineNumber:96,columnNumber:11},this):i.jsxDEV("span",{className:"text-red",children:"Không hoạt động"},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/MobileVehicles.tsx",lineNumber:98,columnNumber:11},this)},{title:"Mã định danh",dataIndex:"eid",width:200},{title:"Ngày đưa vào sử dụng",dataIndex:"used_at",width:200,render:s=>G(s).format(H.DayJSStandard)}].map(s=>({...s,key:(s==null?void 0:s.key)||X()})),b=async(s,a,u)=>{try{m(!0);const n=await Promise.all([await Y({limit:a,page:s},u),await v({})]);d(n[0]),w(n[1]),m(!1)}catch{m(!1)}},N=(s,a)=>{console.log(s),s===r.View&&M(a)},M=s=>{o(i.jsxDEV(S,{detail:s,action:r.View},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/MobileVehicles.tsx",lineNumber:143,columnNumber:15},this),{width:"40vw",onModalClose(a){a!=null&&a.success&&o(i.jsxDEV(S,{detail:s,action:r.Update},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/MobileVehicles.tsx",lineNumber:148,columnNumber:13},this),{width:"40vw",onModalClose(u){u!=null&&u.success&&e()}})}})},e=()=>{b(g.page,g.pageSize,f)};return l.useEffect(()=>{b(g.page,g.pageSize,f)},[f]),i.jsxDEV("div",{className:"w-[900px]",children:i.jsxDEV(J,{total:(c==null?void 0:c.count)||0,className:"mt-5",isReloadButton:!1,dataSource:t,columns:k,actionList:oe,isAction:!1,loading:p,setPagination:h,setFilter:V,paginationCustom:{current:g.page,pageSize:g.pageSize,total:c==null?void 0:c.count},onChange:({current:s,pageSize:a})=>{h({page:s,pageSize:a}),b(s,a,f)},actionClick:N,filterColumns:[C.Name],btnCreate:!0,handleCreate:()=>{o(i.jsxDEV(S,{action:r.Create},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/MobileVehicles.tsx",lineNumber:199,columnNumber:21},this),{width:"40vw",onModalClose(s){s!=null&&s.success&&e()}})}},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/MobileVehicles.tsx",lineNumber:173,columnNumber:7},this)},void 0,!1,{fileName:"/workspace/cskt/CSKT/originaldb-gate-fe/src/modules/operation-categories/pages/MobileVehicles.tsx",lineNumber:172,columnNumber:5},this)}export{oe as ACTION_TABLE,ue as default};
